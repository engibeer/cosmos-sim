<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: begrun.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>begrun.c</h1><a href="begrun_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
00004 <span class="preprocessor">#include &lt;math.h&gt;</span>
00005 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
00006 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00007 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00008 <span class="preprocessor">#include &lt;gsl/gsl_rng.h&gt;</span>
00009 
00010 <span class="preprocessor">#include "<a class="code" href="allvars_8h.html">allvars.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="proto_8h.html">proto.h</a>"</span>
00012 
00013 
<a name="l00028"></a><a class="code" href="proto_8h.html#a3">00028</a> <span class="keywordtype">void</span> <a class="code" href="begrun_8c.html#a4">begrun</a>(<span class="keywordtype">void</span>)
00029 {
00030   <span class="keyword">struct </span><a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a> all;
00031 
00032   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00033     {
00034       printf(<span class="stringliteral">"\nThis is Gadget, version `%s'.\n"</span>, <a class="code" href="allvars_8h.html#a0">GADGETVERSION</a>);
00035       printf(<span class="stringliteral">"\nRunning on %d processors.\n"</span>, <a class="code" href="allvars_8c.html#a1">NTask</a>);
00036     }
00037 
00038   <a class="code" href="proto_8h.html#a138">read_parameter_file</a>(<a class="code" href="allvars_8c.html#a40">ParameterFile</a>);   <span class="comment">/* ... read in parameters for this run */</span>
00039 
00040   <a class="code" href="allocate_8c.html#a0">allocate_commbuffers</a>();       <span class="comment">/* ... allocate buffer-memory for particle </span>
00041 <span class="comment">                                   exchange during force computation */</span>
00042   <a class="code" href="begrun_8c.html#a5">set_units</a>();
00043 
00044 <span class="preprocessor">#if defined(PERIODIC) &amp;&amp; (!defined(PMGRID) || defined(FORCETEST))</span>
00045 <span class="preprocessor"></span>  <a class="code" href="forcetree_8c.html#a37">ewald_init</a>();
00046 <span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span>
00048   <a class="code" href="begrun_8c.html#a6">open_outputfiles</a>();
00049 
00050   <a class="code" href="allvars_8c.html#a15">random_generator</a> = gsl_rng_alloc(gsl_rng_ranlxd1);
00051   gsl_rng_set(<a class="code" href="allvars_8c.html#a15">random_generator</a>, 42);    <span class="comment">/* start-up seed */</span>
00052 
00053 <span class="preprocessor">#ifdef PMGRID</span>
00054 <span class="preprocessor"></span>  <a class="code" href="longrange_8c.html#a0">long_range_init</a>();
00055 <span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span>
00057   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o50">TimeLastRestartFile</a> = CPUThisRun;
00058 
00059   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 0 || <a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 2)
00060     {
00061       <a class="code" href="proto_8h.html#a147">set_random_numbers</a>();
00062 
00063       <a class="code" href="init_8c.html#a0">init</a>();                   <span class="comment">/* ... read in initial model */</span>
00064     }
00065   <span class="keywordflow">else</span>
00066     {
00067       all = All;                <span class="comment">/* save global variables. (will be read from restart file) */</span>
00068 
00069       <a class="code" href="restart_8c.html#a3">restart</a>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a>);     <span class="comment">/* ... read restart file. Note: This also resets </span>
00070 <span class="comment">                                   all variables in the struct `All'. </span>
00071 <span class="comment">                                   However, during the run, some variables in the parameter</span>
00072 <span class="comment">                                   file are allowed to be changed, if desired. These need to </span>
00073 <span class="comment">                                   copied in the way below.</span>
00074 <span class="comment">                                   Note:  All.PartAllocFactor is treated in restart() separately.  </span>
00075 <span class="comment">                                 */</span>
00076 
00077       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o92">MinSizeTimestep</a> = all.<a class="code" href="structglobal__data__all__processes.html#o92">MinSizeTimestep</a>;
00078       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o93">MaxSizeTimestep</a> = all.<a class="code" href="structglobal__data__all__processes.html#o93">MaxSizeTimestep</a>;
00079       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o9">BufferSize</a> = all.<a class="code" href="structglobal__data__all__processes.html#o9">BufferSize</a>;
00080       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o10">BunchSizeForce</a> = all.<a class="code" href="structglobal__data__all__processes.html#o10">BunchSizeForce</a>;
00081       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o11">BunchSizeDensity</a> = all.<a class="code" href="structglobal__data__all__processes.html#o11">BunchSizeDensity</a>;
00082       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o12">BunchSizeHydro</a> = all.<a class="code" href="structglobal__data__all__processes.html#o12">BunchSizeHydro</a>;
00083       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o13">BunchSizeDomain</a> = all.<a class="code" href="structglobal__data__all__processes.html#o13">BunchSizeDomain</a>;
00084 
00085       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o70">TimeLimitCPU</a> = all.<a class="code" href="structglobal__data__all__processes.html#o70">TimeLimitCPU</a>;
00086       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o42">ResubmitOn</a> = all.<a class="code" href="structglobal__data__all__processes.html#o42">ResubmitOn</a>;
00087       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o47">TimeBetSnapshot</a> = all.<a class="code" href="structglobal__data__all__processes.html#o47">TimeBetSnapshot</a>;
00088       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o51">TimeBetStatistics</a> = all.<a class="code" href="structglobal__data__all__processes.html#o51">TimeBetStatistics</a>;
00089       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o49">CpuTimeBetRestartFile</a> = all.<a class="code" href="structglobal__data__all__processes.html#o49">CpuTimeBetRestartFile</a>;
00090       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o91">ErrTolIntAccuracy</a> = all.<a class="code" href="structglobal__data__all__processes.html#o91">ErrTolIntAccuracy</a>;
00091       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o94">MaxRMSDisplacementFac</a> = all.<a class="code" href="structglobal__data__all__processes.html#o94">MaxRMSDisplacementFac</a>;
00092 
00093       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o90">ErrTolForceAcc</a> = all.<a class="code" href="structglobal__data__all__processes.html#o90">ErrTolForceAcc</a>;
00094 
00095       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o44">TypeOfTimestepCriterion</a> = all.<a class="code" href="structglobal__data__all__processes.html#o44">TypeOfTimestepCriterion</a>;
00096       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o43">TypeOfOpeningCriterion</a> = all.<a class="code" href="structglobal__data__all__processes.html#o43">TypeOfOpeningCriterion</a>;
00097       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a> = all.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a>;
00098       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o96">TreeDomainUpdateFrequency</a> = all.<a class="code" href="structglobal__data__all__processes.html#o96">TreeDomainUpdateFrequency</a>;
00099 
00100       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o6">SnapFormat</a> = all.<a class="code" href="structglobal__data__all__processes.html#o6">SnapFormat</a>;
00101       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o7">NumFilesPerSnapshot</a> = all.<a class="code" href="structglobal__data__all__processes.html#o7">NumFilesPerSnapshot</a>;
00102       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o17">MaxNumNgbDeviation</a> = all.<a class="code" href="structglobal__data__all__processes.html#o17">MaxNumNgbDeviation</a>;
00103       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o18">ArtBulkViscConst</a> = all.<a class="code" href="structglobal__data__all__processes.html#o18">ArtBulkViscConst</a>;
00104 
00105 
00106       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o45">OutputListOn</a> = all.<a class="code" href="structglobal__data__all__processes.html#o45">OutputListOn</a>;
00107       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o95">CourantFac</a> = all.<a class="code" href="structglobal__data__all__processes.html#o95">CourantFac</a>;
00108 
00109       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a> = all.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a>;
00110       memcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o124">OutputListTimes</a>, all.<a class="code" href="structglobal__data__all__processes.html#o124">OutputListTimes</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a>);
00111 
00112 
00113       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o122">ResubmitCommand</a>, all.<a class="code" href="structglobal__data__all__processes.html#o122">ResubmitCommand</a>);
00114       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o123">OutputListFilename</a>, all.<a class="code" href="structglobal__data__all__processes.html#o123">OutputListFilename</a>);
00115       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, all.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>);
00116       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o121">RestartFile</a>, all.<a class="code" href="structglobal__data__all__processes.html#o121">RestartFile</a>);
00117       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o117">EnergyFile</a>, all.<a class="code" href="structglobal__data__all__processes.html#o117">EnergyFile</a>);
00118       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o119">InfoFile</a>, all.<a class="code" href="structglobal__data__all__processes.html#o119">InfoFile</a>);
00119       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o118">CpuFile</a>, all.<a class="code" href="structglobal__data__all__processes.html#o118">CpuFile</a>);
00120       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o120">TimingsFile</a>, all.<a class="code" href="structglobal__data__all__processes.html#o120">TimingsFile</a>);
00121       strcpy(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o116">SnapshotFileBase</a>, all.<a class="code" href="structglobal__data__all__processes.html#o116">SnapshotFileBase</a>);
00122 
00123       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a> != all.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a>)
00124         <a class="code" href="proto_8h.html#a139">readjust_timebase</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a>, all.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a>);
00125     }
00126 
00127 <span class="preprocessor">#ifdef PMGRID</span>
00128 <span class="preprocessor"></span>  <a class="code" href="longrange_8c.html#a1">long_range_init_regionsize</a>();
00129 <span class="preprocessor">#endif</span>
00130 <span class="preprocessor"></span>
00131   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>)
00132     <a class="code" href="driftfac_8c.html#a3">init_drift_table</a>();
00133 
00134   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 2)
00135     <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o60">Ti_nextoutput</a> = <a class="code" href="run_8c.html#a2">find_next_outputtime</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o59">Ti_Current</a> + 1);
00136   <span class="keywordflow">else</span>
00137     <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o60">Ti_nextoutput</a> = <a class="code" href="run_8c.html#a2">find_next_outputtime</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o59">Ti_Current</a>);
00138 
00139 
00140   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o50">TimeLastRestartFile</a> = CPUThisRun;
00141 }
00142 
00143 
00144 
00145 
<a name="l00149"></a><a class="code" href="proto_8h.html#a149">00149</a> <span class="keywordtype">void</span> <a class="code" href="begrun_8c.html#a5">set_units</a>(<span class="keywordtype">void</span>)
00150 {
00151   <span class="keywordtype">double</span> meanweight;
00152 
00153   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o28">UnitLength_in_cm</a> / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o27">UnitVelocity_in_cm_per_s</a>;
00154   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o33">UnitTime_in_Megayears</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a> / SEC_PER_MEGAYEAR;
00155 
00156   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o34">GravityConstantInternal</a> == 0)
00157     <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o24">G</a> = <a class="code" href="allvars_8h.html#a12">GRAVITY</a> / <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o28">UnitLength_in_cm</a>, 3) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a> * <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a>, 2);
00158   <span class="keywordflow">else</span>
00159     <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o24">G</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o34">GravityConstantInternal</a>;
00160 
00161   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o30">UnitDensity_in_cgs</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a> / <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o28">UnitLength_in_cm</a>, 3);
00162   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o29">UnitPressure_in_cgs</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a> / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o28">UnitLength_in_cm</a> / <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a>, 2);
00163   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o31">UnitCoolingRate_in_cgs</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o29">UnitPressure_in_cgs</a> / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a>;
00164   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o32">UnitEnergy_in_cgs</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a> * <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o28">UnitLength_in_cm</a>, 2) / <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a>, 2);
00165 
00166   <span class="comment">/* convert some physical input parameters to internal units */</span>
00167 
00168   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o35">Hubble</a> = <a class="code" href="allvars_8h.html#a26">HUBBLE</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a>;
00169 
00170   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00171     {
00172       printf(<span class="stringliteral">"\nHubble (internal units) = %g\n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o35">Hubble</a>);
00173       printf(<span class="stringliteral">"G (internal units) = %g\n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o24">G</a>);
00174       printf(<span class="stringliteral">"UnitMass_in_g = %g \n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a>);
00175       printf(<span class="stringliteral">"UnitTime_in_s = %g \n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o25">UnitTime_in_s</a>);
00176       printf(<span class="stringliteral">"UnitVelocity_in_cm_per_s = %g \n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o27">UnitVelocity_in_cm_per_s</a>);
00177       printf(<span class="stringliteral">"UnitDensity_in_cgs = %g \n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o30">UnitDensity_in_cgs</a>);
00178       printf(<span class="stringliteral">"UnitEnergy_in_cgs = %g \n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o32">UnitEnergy_in_cgs</a>);
00179       printf(<span class="stringliteral">"\n"</span>);
00180     }
00181 
00182   meanweight = 4.0 / (1 + 3 * HYDROGEN_MASSFRAC);       <span class="comment">/* note: we assume neutral gas here */</span>
00183 
00184 <span class="preprocessor">#ifdef ISOTHERM_EQS</span>
00185 <span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o21">MinEgySpec</a> = 0;
00186 <span class="preprocessor">#else</span>
00187 <span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o21">MinEgySpec</a> = 1 / meanweight * (1.0 / GAMMA_MINUS1) * (<a class="code" href="allvars_8h.html#a17">BOLTZMANN</a> / PROTONMASS) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o20">MinGasTemp</a>;
00188   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o21">MinEgySpec</a> *= <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a> / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o32">UnitEnergy_in_cgs</a>;
00189 <span class="preprocessor">#endif</span>
00190 <span class="preprocessor"></span>
00191 }
00192 
00193 
00194 
<a name="l00199"></a><a class="code" href="proto_8h.html#a118">00199</a> <span class="keywordtype">void</span> <a class="code" href="begrun_8c.html#a6">open_outputfiles</a>(<span class="keywordtype">void</span>)
00200 {
00201   <span class="keywordtype">char</span> mode[2], buf[200];
00202 
00203   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> != 0)             <span class="comment">/* only the root processor writes to the log files */</span>
00204     <span class="keywordflow">return</span>;
00205 
00206   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 0)
00207     strcpy(mode, <span class="stringliteral">"w"</span>);
00208   <span class="keywordflow">else</span>
00209     strcpy(mode, <span class="stringliteral">"a"</span>);
00210 
00211 
00212   sprintf(buf, <span class="stringliteral">"%s%s"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o118">CpuFile</a>);
00213   <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a44">FdCPU</a> = fopen(buf, mode)))
00214     {
00215       printf(<span class="stringliteral">"error in opening file '%s'\n"</span>, buf);
00216       <a class="code" href="proto_8h.html#a38">endrun</a>(1);
00217     }
00218 
00219   sprintf(buf, <span class="stringliteral">"%s%s"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o119">InfoFile</a>);
00220   <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a41">FdInfo</a> = fopen(buf, mode)))
00221     {
00222       printf(<span class="stringliteral">"error in opening file '%s'\n"</span>, buf);
00223       <a class="code" href="proto_8h.html#a38">endrun</a>(1);
00224     }
00225 
00226   sprintf(buf, <span class="stringliteral">"%s%s"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o117">EnergyFile</a>);
00227   <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a42">FdEnergy</a> = fopen(buf, mode)))
00228     {
00229       printf(<span class="stringliteral">"error in opening file '%s'\n"</span>, buf);
00230       <a class="code" href="proto_8h.html#a38">endrun</a>(1);
00231     }
00232 
00233   sprintf(buf, <span class="stringliteral">"%s%s"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o120">TimingsFile</a>);
00234   <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a43">FdTimings</a> = fopen(buf, mode)))
00235     {
00236       printf(<span class="stringliteral">"error in opening file '%s'\n"</span>, buf);
00237       <a class="code" href="proto_8h.html#a38">endrun</a>(1);
00238     }
00239 
00240 <span class="preprocessor">#ifdef FORCETEST</span>
00241 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 0)
00242     {
00243       sprintf(buf, <span class="stringliteral">"%s%s"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <span class="stringliteral">"forcetest.txt"</span>);
00244       <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a45">FdForceTest</a> = fopen(buf, <span class="stringliteral">"w"</span>)))
00245         {
00246           printf(<span class="stringliteral">"error in opening file '%s'\n"</span>, buf);
00247           <a class="code" href="proto_8h.html#a38">endrun</a>(1);
00248         }
00249       fclose(<a class="code" href="allvars_8c.html#a45">FdForceTest</a>);
00250     }
00251 <span class="preprocessor">#endif</span>
00252 <span class="preprocessor"></span>}
00253 
00254 
<a name="l00257"></a><a class="code" href="proto_8h.html#a8">00257</a> <span class="keywordtype">void</span> <a class="code" href="begrun_8c.html#a7">close_outputfiles</a>(<span class="keywordtype">void</span>)
00258 {
00259   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> != 0)             <span class="comment">/* only the root processor writes to the log files */</span>
00260     <span class="keywordflow">return</span>;
00261 
00262   fclose(<a class="code" href="allvars_8c.html#a44">FdCPU</a>);
00263   fclose(<a class="code" href="allvars_8c.html#a41">FdInfo</a>);
00264   fclose(<a class="code" href="allvars_8c.html#a42">FdEnergy</a>);
00265   fclose(<a class="code" href="allvars_8c.html#a43">FdTimings</a>);
00266 <span class="preprocessor">#ifdef FORCETEST</span>
00267 <span class="preprocessor"></span>  fclose(<a class="code" href="allvars_8c.html#a45">FdForceTest</a>);
00268 <span class="preprocessor">#endif</span>
00269 <span class="preprocessor"></span>}
00270 
00271 
00272 
00273 
<a name="l00280"></a><a class="code" href="proto_8h.html#a138">00280</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#a138">read_parameter_file</a>(<span class="keywordtype">char</span> *fname)
00281 {
00282 <span class="preprocessor">#define DOUBLE 1</span>
00283 <span class="preprocessor"></span><span class="preprocessor">#define STRING 2</span>
00284 <span class="preprocessor"></span><span class="preprocessor">#define INT 3</span>
00285 <span class="preprocessor"></span><span class="preprocessor">#define MAXTAGS 300</span>
00286 <span class="preprocessor"></span>
00287   FILE *fd, *fdout;
00288   <span class="keywordtype">char</span> buf[200], buf1[200], buf2[200], buf3[400];
00289   <span class="keywordtype">int</span> i, j, nt;
00290   <span class="keywordtype">int</span> <span class="keywordtype">id</span>[MAXTAGS];
00291   <span class="keywordtype">void</span> *addr[MAXTAGS];
00292   <span class="keywordtype">char</span> tag[MAXTAGS][50];
00293   <span class="keywordtype">int</span>  errorFlag = 0;
00294 
00295 
00296   <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> long) != 8)
00297     {
00298       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00299         printf(<span class="stringliteral">"\nType `long long' is not 64 bit on this platform. Stopping.\n\n"</span>);
00300       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00301     }
00302 
00303   <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(int) != 4)
00304     {
00305       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00306         printf(<span class="stringliteral">"\nType `int' is not 32 bit on this platform. Stopping.\n\n"</span>);
00307       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00308     }
00309 
00310   <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(float) != 4)
00311     {
00312       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00313         printf(<span class="stringliteral">"\nType `float' is not 32 bit on this platform. Stopping.\n\n"</span>);
00314       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00315     }
00316 
00317   <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(double) != 8)
00318     {
00319       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00320         printf(<span class="stringliteral">"\nType `double' is not 64 bit on this platform. Stopping.\n\n"</span>);
00321       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00322     }
00323 
00324 
00325   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)             <span class="comment">/* read parameter file on process 0 */</span>
00326     {
00327       nt = 0;
00328 
00329       strcpy(tag[nt], <span class="stringliteral">"InitCondFile"</span>);
00330       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o114">InitCondFile</a>;
00331       <span class="keywordtype">id</span>[nt++] = STRING;
00332 
00333       strcpy(tag[nt], <span class="stringliteral">"OutputDir"</span>);
00334       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>;
00335       <span class="keywordtype">id</span>[nt++] = STRING;
00336 
00337       strcpy(tag[nt], <span class="stringliteral">"SnapshotFileBase"</span>);
00338       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o116">SnapshotFileBase</a>;
00339       <span class="keywordtype">id</span>[nt++] = STRING;
00340 
00341       strcpy(tag[nt], <span class="stringliteral">"EnergyFile"</span>);
00342       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o117">EnergyFile</a>;
00343       <span class="keywordtype">id</span>[nt++] = STRING;
00344 
00345       strcpy(tag[nt], <span class="stringliteral">"CpuFile"</span>);
00346       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o118">CpuFile</a>;
00347       <span class="keywordtype">id</span>[nt++] = STRING;
00348 
00349       strcpy(tag[nt], <span class="stringliteral">"InfoFile"</span>);
00350       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o119">InfoFile</a>;
00351       <span class="keywordtype">id</span>[nt++] = STRING;
00352 
00353       strcpy(tag[nt], <span class="stringliteral">"TimingsFile"</span>);
00354       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o120">TimingsFile</a>;
00355       <span class="keywordtype">id</span>[nt++] = STRING;
00356 
00357       strcpy(tag[nt], <span class="stringliteral">"RestartFile"</span>);
00358       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o121">RestartFile</a>;
00359       <span class="keywordtype">id</span>[nt++] = STRING;
00360 
00361       strcpy(tag[nt], <span class="stringliteral">"ResubmitCommand"</span>);
00362       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o122">ResubmitCommand</a>;
00363       <span class="keywordtype">id</span>[nt++] = STRING;
00364 
00365       strcpy(tag[nt], <span class="stringliteral">"OutputListFilename"</span>);
00366       addr[nt] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o123">OutputListFilename</a>;
00367       <span class="keywordtype">id</span>[nt++] = STRING;
00368 
00369       strcpy(tag[nt], <span class="stringliteral">"OutputListOn"</span>);
00370       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o45">OutputListOn</a>;
00371       <span class="keywordtype">id</span>[nt++] = INT;
00372 
00373       strcpy(tag[nt], <span class="stringliteral">"Omega0"</span>);
00374       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o36">Omega0</a>;
00375       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00376 
00377       strcpy(tag[nt], <span class="stringliteral">"OmegaBaryon"</span>);
00378       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o38">OmegaBaryon</a>;
00379       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00380 
00381       strcpy(tag[nt], <span class="stringliteral">"OmegaLambda"</span>);
00382       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o37">OmegaLambda</a>;
00383       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00384 
00385       strcpy(tag[nt], <span class="stringliteral">"HubbleParam"</span>);
00386       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o39">HubbleParam</a>;
00387       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00388 
00389       strcpy(tag[nt], <span class="stringliteral">"BoxSize"</span>);
00390       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a>;
00391       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00392 
00393       strcpy(tag[nt], <span class="stringliteral">"PeriodicBoundariesOn"</span>);
00394       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o41">PeriodicBoundariesOn</a>;
00395       <span class="keywordtype">id</span>[nt++] = INT;
00396 
00397       strcpy(tag[nt], <span class="stringliteral">"TimeOfFirstSnapshot"</span>);
00398       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o48">TimeOfFirstSnapshot</a>;
00399       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00400 
00401       strcpy(tag[nt], <span class="stringliteral">"CpuTimeBetRestartFile"</span>);
00402       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o49">CpuTimeBetRestartFile</a>;
00403       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00404 
00405       strcpy(tag[nt], <span class="stringliteral">"TimeBetStatistics"</span>);
00406       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o51">TimeBetStatistics</a>;
00407       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00408 
00409       strcpy(tag[nt], <span class="stringliteral">"TimeBegin"</span>);
00410       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>;
00411       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00412 
00413       strcpy(tag[nt], <span class="stringliteral">"TimeMax"</span>);
00414       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a>;
00415       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00416 
00417       strcpy(tag[nt], <span class="stringliteral">"TimeBetSnapshot"</span>);
00418       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o47">TimeBetSnapshot</a>;
00419       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00420 
00421       strcpy(tag[nt], <span class="stringliteral">"UnitVelocity_in_cm_per_s"</span>);
00422       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o27">UnitVelocity_in_cm_per_s</a>;
00423       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00424 
00425       strcpy(tag[nt], <span class="stringliteral">"UnitLength_in_cm"</span>);
00426       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o28">UnitLength_in_cm</a>;
00427       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00428 
00429       strcpy(tag[nt], <span class="stringliteral">"UnitMass_in_g"</span>);
00430       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o26">UnitMass_in_g</a>;
00431       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00432 
00433       strcpy(tag[nt], <span class="stringliteral">"TreeDomainUpdateFrequency"</span>);
00434       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o96">TreeDomainUpdateFrequency</a>;
00435       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00436 
00437       strcpy(tag[nt], <span class="stringliteral">"ErrTolIntAccuracy"</span>);
00438       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o91">ErrTolIntAccuracy</a>;
00439       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00440 
00441       strcpy(tag[nt], <span class="stringliteral">"ErrTolTheta"</span>);
00442       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o89">ErrTolTheta</a>;
00443       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00444 
00445       strcpy(tag[nt], <span class="stringliteral">"ErrTolForceAcc"</span>);
00446       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o90">ErrTolForceAcc</a>;
00447       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00448 
00449       strcpy(tag[nt], <span class="stringliteral">"MinGasHsmlFractional"</span>);
00450       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o97">MinGasHsmlFractional</a>;
00451       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00452 
00453       strcpy(tag[nt], <span class="stringliteral">"MaxSizeTimestep"</span>);
00454       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o93">MaxSizeTimestep</a>;
00455       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00456 
00457       strcpy(tag[nt], <span class="stringliteral">"MinSizeTimestep"</span>);
00458       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o92">MinSizeTimestep</a>;
00459       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00460 
00461       strcpy(tag[nt], <span class="stringliteral">"MaxRMSDisplacementFac"</span>);
00462       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o94">MaxRMSDisplacementFac</a>;
00463       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00464 
00465       strcpy(tag[nt], <span class="stringliteral">"ArtBulkViscConst"</span>);
00466       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o18">ArtBulkViscConst</a>;
00467       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00468 
00469       strcpy(tag[nt], <span class="stringliteral">"CourantFac"</span>);
00470       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o95">CourantFac</a>;
00471       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00472 
00473       strcpy(tag[nt], <span class="stringliteral">"DesNumNgb"</span>);
00474       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o16">DesNumNgb</a>;
00475       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00476 
00477       strcpy(tag[nt], <span class="stringliteral">"MaxNumNgbDeviation"</span>);
00478       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o17">MaxNumNgbDeviation</a>;
00479       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00480 
00481       strcpy(tag[nt], <span class="stringliteral">"ComovingIntegrationOn"</span>);
00482       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>;
00483       <span class="keywordtype">id</span>[nt++] = INT;
00484 
00485       strcpy(tag[nt], <span class="stringliteral">"ICFormat"</span>);
00486       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o5">ICFormat</a>;
00487       <span class="keywordtype">id</span>[nt++] = INT;
00488 
00489       strcpy(tag[nt], <span class="stringliteral">"SnapFormat"</span>);
00490       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o6">SnapFormat</a>;
00491       <span class="keywordtype">id</span>[nt++] = INT;
00492 
00493       strcpy(tag[nt], <span class="stringliteral">"NumFilesPerSnapshot"</span>);
00494       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o7">NumFilesPerSnapshot</a>;
00495       <span class="keywordtype">id</span>[nt++] = INT;
00496 
00497       strcpy(tag[nt], <span class="stringliteral">"NumFilesWrittenInParallel"</span>);
00498       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a>;
00499       <span class="keywordtype">id</span>[nt++] = INT;
00500 
00501       strcpy(tag[nt], <span class="stringliteral">"ResubmitOn"</span>);
00502       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o42">ResubmitOn</a>;
00503       <span class="keywordtype">id</span>[nt++] = INT;
00504 
00505       strcpy(tag[nt], <span class="stringliteral">"TypeOfTimestepCriterion"</span>);
00506       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o44">TypeOfTimestepCriterion</a>;
00507       <span class="keywordtype">id</span>[nt++] = INT;
00508 
00509       strcpy(tag[nt], <span class="stringliteral">"TypeOfOpeningCriterion"</span>);
00510       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o43">TypeOfOpeningCriterion</a>;
00511       <span class="keywordtype">id</span>[nt++] = INT;
00512 
00513       strcpy(tag[nt], <span class="stringliteral">"TimeLimitCPU"</span>);
00514       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o70">TimeLimitCPU</a>;
00515       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00516 
00517       strcpy(tag[nt], <span class="stringliteral">"SofteningHalo"</span>);
00518       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o100">SofteningHalo</a>;
00519       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00520 
00521       strcpy(tag[nt], <span class="stringliteral">"SofteningDisk"</span>);
00522       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o101">SofteningDisk</a>;
00523       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00524 
00525       strcpy(tag[nt], <span class="stringliteral">"SofteningBulge"</span>);
00526       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o102">SofteningBulge</a>;
00527       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00528 
00529       strcpy(tag[nt], <span class="stringliteral">"SofteningGas"</span>);
00530       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o99">SofteningGas</a>;
00531       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00532 
00533       strcpy(tag[nt], <span class="stringliteral">"SofteningStars"</span>);
00534       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o103">SofteningStars</a>;
00535       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00536 
00537       strcpy(tag[nt], <span class="stringliteral">"SofteningBndry"</span>);
00538       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o104">SofteningBndry</a>;
00539       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00540 
00541       strcpy(tag[nt], <span class="stringliteral">"SofteningHaloMaxPhys"</span>);
00542       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o106">SofteningHaloMaxPhys</a>;
00543       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00544 
00545       strcpy(tag[nt], <span class="stringliteral">"SofteningDiskMaxPhys"</span>);
00546       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o107">SofteningDiskMaxPhys</a>;
00547       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00548 
00549       strcpy(tag[nt], <span class="stringliteral">"SofteningBulgeMaxPhys"</span>);
00550       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o108">SofteningBulgeMaxPhys</a>;
00551       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00552 
00553       strcpy(tag[nt], <span class="stringliteral">"SofteningGasMaxPhys"</span>);
00554       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o105">SofteningGasMaxPhys</a>;
00555       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00556 
00557       strcpy(tag[nt], <span class="stringliteral">"SofteningStarsMaxPhys"</span>);
00558       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o109">SofteningStarsMaxPhys</a>;
00559       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00560 
00561       strcpy(tag[nt], <span class="stringliteral">"SofteningBndryMaxPhys"</span>);
00562       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o110">SofteningBndryMaxPhys</a>;
00563       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00564 
00565       strcpy(tag[nt], <span class="stringliteral">"BufferSize"</span>);
00566       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o9">BufferSize</a>;
00567       <span class="keywordtype">id</span>[nt++] = INT;
00568 
00569       strcpy(tag[nt], <span class="stringliteral">"PartAllocFactor"</span>);
00570       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a>;
00571       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00572 
00573       strcpy(tag[nt], <span class="stringliteral">"TreeAllocFactor"</span>);
00574       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a>;
00575       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00576 
00577       strcpy(tag[nt], <span class="stringliteral">"GravityConstantInternal"</span>);
00578       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o34">GravityConstantInternal</a>;
00579       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00580 
00581       strcpy(tag[nt], <span class="stringliteral">"InitGasTemp"</span>);
00582       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o19">InitGasTemp</a>;
00583       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00584 
00585       strcpy(tag[nt], <span class="stringliteral">"MinGasTemp"</span>);
00586       addr[nt] = &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o20">MinGasTemp</a>;
00587       <span class="keywordtype">id</span>[nt++] = DOUBLE;
00588 
00589       <span class="keywordflow">if</span>((fd = fopen(fname, <span class="stringliteral">"r"</span>)))
00590         {
00591           sprintf(buf, <span class="stringliteral">"%s%s"</span>, fname, <span class="stringliteral">"-usedvalues"</span>);
00592           <span class="keywordflow">if</span>(!(fdout = fopen(buf, <span class="stringliteral">"w"</span>)))
00593             {
00594               printf(<span class="stringliteral">"error opening file '%s' \n"</span>, buf);
00595               errorFlag = 1;
00596             }
00597           <span class="keywordflow">else</span>
00598             {
00599               <span class="keywordflow">while</span>(!feof(fd))
00600                 {
00601                   *buf = 0;
00602                   fgets(buf, 200, fd);
00603                   <span class="keywordflow">if</span>(sscanf(buf, <span class="stringliteral">"%s%s%s"</span>, buf1, buf2, buf3) &lt; 2)
00604                     <span class="keywordflow">continue</span>;
00605 
00606                   <span class="keywordflow">if</span>(buf1[0] == <span class="charliteral">'%'</span>)
00607                     <span class="keywordflow">continue</span>;
00608 
00609                   <span class="keywordflow">for</span>(i = 0, j = -1; i &lt; nt; i++)
00610                     <span class="keywordflow">if</span>(strcmp(buf1, tag[i]) == 0)
00611                       {
00612                         j = i;
00613                         tag[i][0] = 0;
00614                         <span class="keywordflow">break</span>;
00615                       }
00616 
00617                   <span class="keywordflow">if</span>(j &gt;= 0)
00618                     {
00619                       <span class="keywordflow">switch</span> (<span class="keywordtype">id</span>[j])
00620                         {
00621                         <span class="keywordflow">case</span> <a class="code" href="begrun_8c.html#a0">DOUBLE</a>:
00622                           *((<span class="keywordtype">double</span> *) addr[j]) = atof(buf2);
00623                           fprintf(fdout, <span class="stringliteral">"%-35s%g\n"</span>, buf1, *((<span class="keywordtype">double</span> *) addr[j]));
00624                           <span class="keywordflow">break</span>;
00625                         <span class="keywordflow">case</span> <a class="code" href="begrun_8c.html#a1">STRING</a>:
00626                           strcpy(addr[j], buf2);
00627                           fprintf(fdout, <span class="stringliteral">"%-35s%s\n"</span>, buf1, buf2);
00628                           <span class="keywordflow">break</span>;
00629                         <span class="keywordflow">case</span> <a class="code" href="begrun_8c.html#a2">INT</a>:
00630                           *((<span class="keywordtype">int</span> *) addr[j]) = atoi(buf2);
00631                           fprintf(fdout, <span class="stringliteral">"%-35s%d\n"</span>, buf1, *((<span class="keywordtype">int</span> *) addr[j]));
00632                           <span class="keywordflow">break</span>;
00633                         }
00634                     }
00635                   <span class="keywordflow">else</span>
00636                     {
00637                       fprintf(stdout, <span class="stringliteral">"Error in file %s:   Tag '%s' not allowed or multiple defined.\n"</span>,
00638                               fname, buf1);
00639                       errorFlag = 1;
00640                     }
00641                 }
00642               fclose(fd);
00643               fclose(fdout);
00644 
00645               i = strlen(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>);
00646               <span class="keywordflow">if</span>(i &gt; 0)
00647                 <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>[i - 1] != <span class="charliteral">'/'</span>)
00648                   strcat(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <span class="stringliteral">"/"</span>);
00649 
00650               sprintf(buf1, <span class="stringliteral">"%s%s"</span>, fname, <span class="stringliteral">"-usedvalues"</span>);
00651               sprintf(buf2, <span class="stringliteral">"%s%s"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <span class="stringliteral">"parameters-usedvalues"</span>);
00652               sprintf(buf3, <span class="stringliteral">"cp %s %s"</span>, buf1, buf2);
00653               system(buf3);
00654             }
00655         }
00656       <span class="keywordflow">else</span>
00657         {
00658           printf(<span class="stringliteral">"\nParameter file %s not found.\n\n"</span>, fname);
00659           errorFlag = 2;
00660         }
00661 
00662       <span class="keywordflow">if</span>(errorFlag != 2)
00663         <span class="keywordflow">for</span>(i = 0; i &lt; nt; i++)
00664           {
00665             <span class="keywordflow">if</span>(*tag[i])
00666               {
00667                 printf(<span class="stringliteral">"Error. I miss a value for tag '%s' in parameter file '%s'.\n"</span>, tag[i], fname);
00668                 errorFlag = 1;
00669               }
00670           }
00671 
00672       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o45">OutputListOn</a> &amp;&amp; errorFlag == 0)
00673         errorFlag += <a class="code" href="proto_8h.html#a137">read_outputlist</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o123">OutputListFilename</a>);
00674       <span class="keywordflow">else</span>
00675         <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a> = 0;
00676     }
00677 
00678   MPI_Bcast(&amp;errorFlag, 1, MPI_INT, 0, MPI_COMM_WORLD);
00679 
00680   <span class="keywordflow">if</span>(errorFlag)
00681     {
00682       MPI_Finalize();
00683       exit(0);
00684     }
00685 
00686   <span class="comment">/* now communicate the relevant parameters to the other processes */</span>
00687   MPI_Bcast(&amp;<a class="code" href="allvars_8c.html#a50">All</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a>), MPI_BYTE, 0, MPI_COMM_WORLD);
00688 
00689 
00690   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a> &lt; 1)
00691     {
00692       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00693         printf(<span class="stringliteral">"NumFilesWrittenInParallel MUST be at least 1\n"</span>);
00694       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00695     }
00696 
00697   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a> &gt; NTask)
00698     {
00699       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00700         printf(<span class="stringliteral">"NumFilesWrittenInParallel MUST be smaller than number of processors\n"</span>);
00701       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00702     }
00703 
00704 <span class="preprocessor">#ifdef PERIODIC</span>
00705 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o41">PeriodicBoundariesOn</a> == 0)
00706     {
00707       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00708         {
00709           printf(<span class="stringliteral">"Code was compiled with periodic boundary conditions switched on.\n"</span>);
00710           printf(<span class="stringliteral">"You must set `PeriodicBoundariesOn=1', or recompile the code.\n"</span>);
00711         }
00712       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00713     }
00714 <span class="preprocessor">#else</span>
00715 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o41">PeriodicBoundariesOn</a> == 1)
00716     {
00717       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00718         {
00719           printf(<span class="stringliteral">"Code was compiled with periodic boundary conditions switched off.\n"</span>);
00720           printf(<span class="stringliteral">"You must set `PeriodicBoundariesOn=0', or recompile the code.\n"</span>);
00721         }
00722       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00723     }
00724 <span class="preprocessor">#endif</span>
00725 <span class="preprocessor"></span>
00726 
00727   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o44">TypeOfTimestepCriterion</a> &gt;= 1)
00728     {
00729       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00730         {
00731           printf(<span class="stringliteral">"The specified timestep criterion\n"</span>);
00732           printf(<span class="stringliteral">"is not valid\n"</span>);
00733         }
00734       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00735     }
00736 
00737 <span class="preprocessor">#if defined(LONG_X) ||  defined(LONG_Y) || defined(LONG_Z)</span>
00738 <span class="preprocessor"></span><span class="preprocessor">#ifndef NOGRAVITY</span>
00739 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00740     {
00741       printf(<span class="stringliteral">"Code was compiled with LONG_X/Y/Z, but not with NOGRAVITY.\n"</span>);
00742       printf(<span class="stringliteral">"Stretched periodic boxes are not implemented for gravity yet.\n"</span>);
00743     }
00744   <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00745 <span class="preprocessor">#endif</span>
00746 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00747 <span class="preprocessor"></span>
00748 <span class="preprocessor">#undef DOUBLE</span>
00749 <span class="preprocessor"></span><span class="preprocessor">#undef STRING</span>
00750 <span class="preprocessor"></span><span class="preprocessor">#undef INT</span>
00751 <span class="preprocessor"></span><span class="preprocessor">#undef MAXTAGS</span>
00752 <span class="preprocessor"></span>}
00753 
00754 
<a name="l00759"></a><a class="code" href="proto_8h.html#a137">00759</a> <span class="keywordtype">int</span> <a class="code" href="proto_8h.html#a137">read_outputlist</a>(<span class="keywordtype">char</span> *fname)
00760 {
00761   FILE *fd;
00762 
00763   <span class="keywordflow">if</span>(!(fd = fopen(fname, <span class="stringliteral">"r"</span>)))
00764     {
00765       printf(<span class="stringliteral">"can't read output list in file '%s'\n"</span>, fname);
00766       <span class="keywordflow">return</span> 1;
00767     }
00768 
00769   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a> = 0;
00770   <span class="keywordflow">do</span>
00771     {
00772       <span class="keywordflow">if</span>(fscanf(fd, <span class="stringliteral">" %lg "</span>, &amp;<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o124">OutputListTimes</a>[<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a>]) == 1)
00773         <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a>++;
00774       <span class="keywordflow">else</span>
00775         <span class="keywordflow">break</span>;
00776     }
00777   <span class="keywordflow">while</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a> &lt; MAXLEN_OUTPUTLIST);
00778 
00779   fclose(fd);
00780 
00781   printf(<span class="stringliteral">"\nfound %d times in output-list.\n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o125">OutputListLength</a>);
00782 
00783   <span class="keywordflow">return</span> 0;
00784 }
00785 
00786 
<a name="l00793"></a><a class="code" href="proto_8h.html#a139">00793</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#a139">readjust_timebase</a>(<span class="keywordtype">double</span> TimeMax_old, <span class="keywordtype">double</span> TimeMax_new)
00794 {
00795   <span class="keywordtype">int</span> i;
00796   <span class="keywordtype">long</span> <span class="keywordtype">long</span> ti_end;
00797 
00798   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00799     {
00800       printf(<span class="stringliteral">"\nAll.TimeMax has been changed in the parameterfile\n"</span>);
00801       printf(<span class="stringliteral">"Need to adjust integer timeline\n\n\n"</span>);
00802     }
00803 
00804   <span class="keywordflow">if</span>(TimeMax_new &lt; TimeMax_old)
00805     {
00806       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00807         printf(<span class="stringliteral">"\nIt is not allowed to reduce All.TimeMax\n\n"</span>);
00808       <a class="code" href="proto_8h.html#a38">endrun</a>(556);
00809     }
00810 
00811   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>)
00812     ti_end = log(TimeMax_new / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>) / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a>;
00813   <span class="keywordflow">else</span>
00814     ti_end = (TimeMax_new - <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>) / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a>;
00815 
00816   <span class="keywordflow">while</span>(ti_end &gt; TIMEBASE)
00817     {
00818       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a> *= 2.0;
00819 
00820       ti_end /= 2;
00821       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o59">Ti_Current</a> /= 2;
00822 
00823 <span class="preprocessor">#ifdef PMGRID</span>
00824 <span class="preprocessor"></span>      <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o62">PM_Ti_begstep</a> /= 2;
00825       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o61">PM_Ti_endstep</a> /= 2;
00826 <span class="preprocessor">#endif</span>
00827 <span class="preprocessor"></span>
00828       <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00829         {
00830           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o11">Ti_begstep</a> /= 2;
00831           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o10">Ti_endstep</a> /= 2;
00832         }
00833     }
00834 
00835   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a> = TimeMax_new;
00836 }
00837 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:40 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
