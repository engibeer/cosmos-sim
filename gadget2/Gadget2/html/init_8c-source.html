<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: init.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>init.c</h1><a href="init_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00002 <span class="preprocessor">#include &lt;string.h&gt;</span>
00003 <span class="preprocessor">#include &lt;math.h&gt;</span>
00004 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
00005 
00006 <span class="preprocessor">#include "<a class="code" href="allvars_8h.html">allvars.h</a>"</span>
00007 <span class="preprocessor">#include "<a class="code" href="proto_8h.html">proto.h</a>"</span>
00008 
00009 
<a name="l00020"></a><a class="code" href="proto_8h.html#a100">00020</a> <span class="keywordtype">void</span> <a class="code" href="init_8c.html#a0">init</a>(<span class="keywordtype">void</span>)
00021 {
00022   <span class="keywordtype">int</span> i, j;
00023   <span class="keywordtype">double</span> a3;
00024 
00025   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>;
00026 
00027   <span class="keywordflow">switch</span> (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o5">ICFormat</a>)
00028     {
00029     <span class="keywordflow">case</span> 1:
00030 <span class="preprocessor">#if (MAKEGLASS &gt; 1)</span>
00031 <span class="preprocessor"></span>      <a class="code" href="proto_8h.html#a146">seed_glass</a>();
00032 <span class="preprocessor">#else</span>
00033 <span class="preprocessor"></span>      <a class="code" href="read__ic_8c.html#a2">read_ic</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o114">InitCondFile</a>);
00034 <span class="preprocessor">#endif</span>
00035 <span class="preprocessor"></span>      <span class="keywordflow">break</span>;
00036     <span class="keywordflow">case</span> 2:
00037     <span class="keywordflow">case</span> 3:
00038       <a class="code" href="read__ic_8c.html#a2">read_ic</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o114">InitCondFile</a>);
00039       <span class="keywordflow">break</span>;
00040     <span class="keywordflow">default</span>:
00041       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00042         printf(<span class="stringliteral">"ICFormat=%d not supported.\n"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o5">ICFormat</a>);
00043       <a class="code" href="proto_8h.html#a38">endrun</a>(0);
00044     }
00045 
00046   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>;
00047   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o59">Ti_Current</a> = 0;
00048 
00049   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>)
00050     {
00051       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a> = (log(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a>) - log(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>)) / TIMEBASE;
00052       a3 = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a>;
00053     }
00054   <span class="keywordflow">else</span>
00055     {
00056       <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a> = (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o57">TimeMax</a> - <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a>) / TIMEBASE;
00057       a3 = 1;
00058     }
00059 
00060   <a class="code" href="gravtree_8c.html#a1">set_softenings</a>();
00061 
00062   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o53">NumCurrentTiStep</a> = 0;     <span class="comment">/* setup some counters */</span>
00063   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o46">SnapshotFileCount</a> = 0;
00064   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 2)
00065     <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o46">SnapshotFileCount</a> = atoi(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o114">InitCondFile</a> + strlen(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o114">InitCondFile</a>) - 3) + 1;
00066 
00067   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o22">TotNumOfForces</a> = 0;
00068   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o23">NumForcesSinceLastDomainDecomp</a> = 0;
00069 
00070   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>)
00071     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o41">PeriodicBoundariesOn</a> == 1)
00072       <a class="code" href="init_8c.html#a1">check_omega</a>();
00073 
00074   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o52">TimeLastStatistics</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o55">TimeBegin</a> - <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o51">TimeBetStatistics</a>;
00075 
00076   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>) <span class="comment">/*  change to new velocity variable */</span>
00077     {
00078       <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00079         <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00080           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o2">Vel</a>[j] *= sqrt(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a>) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a>;
00081     }
00082 
00083   <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)  <span class="comment">/*  start-up initialization */</span>
00084     {
00085       <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00086         <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o3">GravAccel</a>[j] = 0;
00087 <span class="preprocessor">#ifdef PMGRID</span>
00088 <span class="preprocessor"></span>      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00089         <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o4">GravPM</a>[j] = 0;
00090 <span class="preprocessor">#endif</span>
00091 <span class="preprocessor"></span>      <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o10">Ti_endstep</a> = 0;
00092       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o11">Ti_begstep</a> = 0;
00093 
00094       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o7">OldAcc</a> = 0;
00095       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o12">GravCost</a> = 1;
00096       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o6">Potential</a> = 0;
00097     }
00098 
00099 <span class="preprocessor">#ifdef PMGRID</span>
00100 <span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o61">PM_Ti_endstep</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o62">PM_Ti_begstep</a> = 0;
00101 <span class="preprocessor">#endif</span>
00102 <span class="preprocessor"></span>
00103 <span class="preprocessor">#ifdef FLEXSTEPS</span>
00104 <span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a50">All</a>.PresentMinStep = TIMEBASE;
00105   <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)  <span class="comment">/*  start-up initialization */</span>
00106     {
00107       <a class="code" href="allvars_8c.html#a51">P</a>[i].FlexStepGrp = (int) (<a class="code" href="allvars_8h.html#a1">TIMEBASE</a> * <a class="code" href="system_8c.html#a0">get_random_number</a>(<a class="code" href="allvars_8c.html#a51">P</a>[i].ID));
00108     }
00109 <span class="preprocessor">#endif</span>
00110 <span class="preprocessor"></span>
00111 
00112   <span class="keywordflow">for</span>(i = 0; i &lt; N_gas; i++)    <span class="comment">/* initialize sph_properties */</span>
00113     {
00114       <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00115         {
00116           <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o9">VelPred</a>[j] = <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o2">Vel</a>[j];
00117           <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o8">HydroAccel</a>[j] = 0;
00118         }
00119 
00120       <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o7">DtEntropy</a> = 0;
00121 
00122       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 0)
00123         {
00124           <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o2">Hsml</a> = 0;
00125           <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o1">Density</a> = -1;
00126         }
00127     }
00128 
00129   <a class="code" href="proto_8h.html#a110">ngb_treeallocate</a>(<a class="code" href="allvars_8h.html#a31">MAX_NGB</a>);
00130 
00131   <a class="code" href="proto_8h.html#a57">force_treeallocate</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>);
00132 
00133   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o23">NumForcesSinceLastDomainDecomp</a> = 1 + <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o96">TreeDomainUpdateFrequency</a>;
00134 
00135   <a class="code" href="allvars_8c.html#a14">Flag_FullStep</a> = 1;            <span class="comment">/* to ensure that Peano-Hilber order is done */</span>
00136 
00137   <a class="code" href="domain_8c.html#a15">domain_Decomposition</a>();       <span class="comment">/* do initial domain decomposition (gives equal numbers of particles) */</span>
00138 
00139   <a class="code" href="ngb_8c.html#a16">ngb_treebuild</a>();              <span class="comment">/* will build tree */</span>
00140 
00141   <a class="code" href="init_8c.html#a2">setup_smoothinglengths</a>();
00142 
00143   <a class="code" href="allvars_8c.html#a13">TreeReconstructFlag</a> = 1;
00144 
00145   <span class="comment">/* at this point, the entropy variable normally contains the </span>
00146 <span class="comment">   * internal energy, read in from the initial conditions file, unless the file</span>
00147 <span class="comment">   * explicitly signals that the initial conditions contain the entropy directly. </span>
00148 <span class="comment">   * Once the density has been computed, we can convert thermal energy to entropy.</span>
00149 <span class="comment">   */</span>
00150 <span class="preprocessor">#ifndef ISOTHERM_EQS</span>
00151 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a63">header</a>.<a class="code" href="structio__header.html#o16">flag_entropy_instead_u</a> == 0)
00152     <span class="keywordflow">for</span>(i = 0; i &lt; N_gas; i++)
00153       <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o0">Entropy</a> = <a class="code" href="allvars_8h.html#a10">GAMMA_MINUS1</a> * <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o0">Entropy</a> / <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a53">SphP</a>[i].Density / a3, <a class="code" href="allvars_8h.html#a10">GAMMA_MINUS1</a>);
00154 <span class="preprocessor">#endif</span>
00155 <span class="preprocessor"></span>}
00156 
00157 
00161 <span class="keywordtype">void</span> <a class="code" href="init_8c.html#a1">check_omega</a>(<span class="keywordtype">void</span>)
00162 {
00163   <span class="keywordtype">double</span> mass = 0, masstot, omega;
00164   <span class="keywordtype">int</span> i;
<a name="l00165"></a><a class="code" href="proto_8h.html#a7">00165</a> 
00166   <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00167     mass += <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o1">Mass</a>;
00168 
00169   MPI_Allreduce(&amp;mass, &amp;masstot, 1, MPI_DOUBLE, MPI_SUM, MPI_COMM_WORLD);
00170 
00171   omega =
00172     masstot / (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a>) / (3 * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o35">Hubble</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o35">Hubble</a> / (8 * M_PI * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o24">G</a>));
00173 
00174   <span class="keywordflow">if</span>(fabs(omega - <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o36">Omega0</a>) &gt; 1.0e-3)
00175     {
00176       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00177         {
00178           printf(<span class="stringliteral">"\n\nI've found something odd!\n"</span>);
00179           printf
00180             (<span class="stringliteral">"The mass content accounts only for Omega=%g,\nbut you specified Omega=%g in the parameterfile.\n"</span>,
00181              omega, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o36">Omega0</a>);
00182           printf(<span class="stringliteral">"\nI better stop.\n"</span>);
00183 
00184           fflush(stdout);
00185         }
00186       <a class="code" href="proto_8h.html#a38">endrun</a>(1);
00187     }
00188 }
00189 
00190 
00191 
00198 <span class="keywordtype">void</span> <a class="code" href="init_8c.html#a2">setup_smoothinglengths</a>(<span class="keywordtype">void</span>)
00199 {
00200   <span class="keywordtype">int</span> i, no, p;
00201 
<a name="l00202"></a><a class="code" href="proto_8h.html#a150">00202</a>   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a10">RestartFlag</a> == 0)
00203     {
00204 
00205       <span class="keywordflow">for</span>(i = 0; i &lt; N_gas; i++)
00206         {
00207           no = <a class="code" href="allvars_8c.html#a60">Father</a>[i];
00208 
00209           <span class="keywordflow">while</span>(10 * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o16">DesNumNgb</a> * <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o1">Mass</a> &gt; <a class="code" href="allvars_8c.html#a58">Nodes</a>[no].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o4">mass</a>)
00210             {
00211               p = <a class="code" href="allvars_8c.html#a58">Nodes</a>[no].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o8">father</a>;
00212 
00213               <span class="keywordflow">if</span>(p &lt; 0)
00214                 <span class="keywordflow">break</span>;
00215 
00216               no = p;
00217             }
00218 <span class="preprocessor">#ifndef TWODIMS</span>
00219 <span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o2">Hsml</a> =
00220             <a class="code" href="proto_8h.html#a133">pow</a>(3.0 / (4 * M_PI) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o16">DesNumNgb</a> * <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o1">Mass</a> / <a class="code" href="allvars_8c.html#a58">Nodes</a>[no].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o4">mass</a>, 1.0 / 3) * <a class="code" href="allvars_8c.html#a58">Nodes</a>[no].<a class="code" href="structNODE.html#o0">len</a>;
00221 <span class="preprocessor">#else</span>
00222 <span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o2">Hsml</a> =
00223             <a class="code" href="proto_8h.html#a133">pow</a>(1.0 / (M_PI) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o16">DesNumNgb</a> * <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o1">Mass</a> / <a class="code" href="allvars_8c.html#a58">Nodes</a>[no].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o4">mass</a>, 1.0 / 2) * <a class="code" href="allvars_8c.html#a58">Nodes</a>[no].<a class="code" href="structNODE.html#o0">len</a>;
00224 <span class="preprocessor">#endif</span>
00225 <span class="preprocessor"></span>        }
00226     }
00227 
00228   <a class="code" href="density_8c.html#a8">density</a>();
00229 }
00230 
00231 
00235 <span class="preprocessor">#if (MAKEGLASS &gt; 1)</span>
00236 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="proto_8h.html#a146">seed_glass</a>(<span class="keywordtype">void</span>)
00237 {
00238   <span class="keywordtype">int</span> i, k, n_for_this_task;
00239   <span class="keywordtype">double</span> Range[3], LowerBound[3];
00240   <span class="keywordtype">double</span> drandom, partmass;
00241   <span class="keywordtype">long</span> <span class="keywordtype">long</span> IDstart;
00242 
00243   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> = MAKEGLASS;
00244   partmass = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o36">Omega0</a> * (3 * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o35">Hubble</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o35">Hubble</a> / (8 * M_PI * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o24">G</a>))
00245     * (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a>) / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a>;
00246 
00247   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> / NTask); <span class="comment">/* sets the maximum number of particles that may */</span>
00248 
00249   <a class="code" href="allocate_8c.html#a1">allocate_memory</a>();
00250 
00251   <a class="code" href="allvars_8c.html#a63">header</a>.<a class="code" href="structio__header.html#o6">npartTotal</a>[1] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a>;
00252   <a class="code" href="allvars_8c.html#a63">header</a>.<a class="code" href="structio__header.html#o1">mass</a>[1] = partmass;
00253 
00254   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0)
00255     {
00256       printf(<span class="stringliteral">"\nGlass initialising\nPartMass= %g\n"</span>, partmass);
00257       printf(<span class="stringliteral">"TotNumPart= %d%09d\n\n"</span>,
00258              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> % 1000000000));
00259     }
00260 
00261   <span class="comment">/* set the number of particles assigned locally to this task */</span>
00262   n_for_this_task = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> / NTask;
00263 
00264   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == <a class="code" href="allvars_8c.html#a1">NTask</a> - 1)
00265     n_for_this_task = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> - (<a class="code" href="allvars_8c.html#a1">NTask</a> - 1) * n_for_this_task;
00266 
00267   <a class="code" href="allvars_8c.html#a3">NumPart</a> = 0;
00268   IDstart = 1 + (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> / NTask) * ThisTask;
00269 
00270   <span class="comment">/* split the temporal domain into Ntask slabs in z-direction */</span>
00271 
00272   Range[0] = Range[1] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a>;
00273   Range[2] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a> / NTask;
00274   LowerBound[0] = LowerBound[1] = 0;
00275   LowerBound[2] = <a class="code" href="allvars_8c.html#a0">ThisTask</a> * Range[2];
00276 
00277   srand48(ThisTask);
00278 
00279   <span class="keywordflow">for</span>(i = 0; i &lt; n_for_this_task; i++)
00280     {
00281       <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
00282         {
00283           drandom = drand48();
00284 
00285           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o0">Pos</a>[k] = LowerBound[k] + Range[k] * drandom;
00286           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o2">Vel</a>[k] = 0;
00287         }
00288 
00289       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o1">Mass</a> = partmass;
00290       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o9">Type</a> = 1;
00291       <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o8">ID</a> = IDstart + i;
00292 
00293       <a class="code" href="allvars_8c.html#a3">NumPart</a>++;
00294     }
00295 }
00296 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:41 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
