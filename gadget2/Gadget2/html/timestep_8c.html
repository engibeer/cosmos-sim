<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: timestep.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>timestep.c File Reference</h1>routines for 'kicking' particles in momentum space and assigning new timesteps <a href="#_details">More...</a>
<p>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;mpi.h&gt;</code><br>
<code>#include "<a class="el" href="allvars_8h-source.html">allvars.h</a>"</code><br>
<code>#include "<a class="el" href="proto_8h-source.html">proto.h</a>"</code><br>

<p>
<a href="timestep_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a7">advance_and_find_timesteps</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a8">get_timestep</a> (int p, double *aphys, int flag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a9">find_dt_displacement_constraint</a> (double hfac)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
routines for 'kicking' particles in momentum space and assigning new timesteps 
<p>

<p>
Definition in file <a class="el" href="timestep_8c-source.html">timestep.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="a7" doxytag="timestep.c::advance_and_find_timesteps"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void advance_and_find_timesteps           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function advances the system in momentum space, i.e. it does apply the 'kick' operation after the forces have been computed. Additionally, it assigns new timesteps to particles. At start-up, a half-timestep is carried out, as well as at the end of the simulation. In between, the half-step kick that ends the previous timestep and the half-step kick for the new timestep are combined into one operation.<p>
&lt; adiabatic index of simulated gas <p>
&lt; adiabatic index of simulated gas <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <p>
&lt; adiabatic index of simulated gas <p>
&lt; adiabatic index of simulated gas <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 
<p>
Definition at line <a class="el" href="timestep_8c-source.html#l00024">24</a> of file <a class="el" href="timestep_8c-source.html">timestep.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00328">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="allvars_8h-source.html#l00402">global_data_all_processes::CPU_TimeLine</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8h-source.html#l00542">sph_particle_data::DtEntropy</a>, <a class="el" href="allvars_8h-source.html#l00535">sph_particle_data::Entropy</a>, <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8c-source.html#l00148">Father</a>, <a class="el" href="timestep_8c-source.html#l00582">find_dt_displacement_constraint()</a>, <a class="el" href="allvars_8c-source.html#l00036">Flag_FullStep</a>, <a class="el" href="allvars_8h-source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h-source.html#l00302">global_data_all_processes::G</a>, <a class="el" href="allvars_8h-source.html#l00052">GAMMA</a>, <a class="el" href="allvars_8h-source.html#l00055">GAMMA_MINUS1</a>, <a class="el" href="driftfac_8c-source.html#l00105">get_gravkick_factor()</a>, <a class="el" href="driftfac_8c-source.html#l00142">get_hydrokick_factor()</a>, <a class="el" href="system_8c-source.html#l00029">get_random_number()</a>, <a class="el" href="timestep_8c-source.html#l00437">get_timestep()</a>, <a class="el" href="allvars_8h-source.html#l00497">particle_data::GravAccel</a>, <a class="el" href="allvars_8h-source.html#l00499">particle_data::GravPM</a>, <a class="el" href="allvars_8h-source.html#l00319">global_data_all_processes::Hubble</a>, <a class="el" href="allvars_8h-source.html#l00543">sph_particle_data::HydroAccel</a>, <a class="el" href="allvars_8h-source.html#l00578">NODE::mass</a>, <a class="el" href="allvars_8h-source.html#l00495">particle_data::Mass</a>, <a class="el" href="allvars_8h-source.html#l00419">global_data_all_processes::MaxSizeTimestep</a>, <a class="el" href="allvars_8h-source.html#l00291">global_data_all_processes::MinEgySpec</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8h-source.html#l00297">global_data_all_processes::NumForcesSinceLastDomainDecomp</a>, <a class="el" href="allvars_8h-source.html#l00320">global_data_all_processes::Omega0</a>, <a class="el" href="allvars_8h-source.html#l00321">global_data_all_processes::OmegaLambda</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00367">global_data_all_processes::PM_Ti_begstep</a>, <a class="el" href="allvars_8h-source.html#l00366">global_data_all_processes::PM_Ti_endstep</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="proto_8h.html#a133">pow()</a>, <a class="el" href="system_8c-source.html#l00053">second()</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h-source.html#l00514">particle_data::Ti_begstep</a>, <a class="el" href="allvars_8h-source.html#l00359">global_data_all_processes::Ti_Current</a>, <a class="el" href="allvars_8h-source.html#l00513">particle_data::Ti_endstep</a>, <a class="el" href="allvars_8h-source.html#l00350">global_data_all_processes::Time</a>, <a class="el" href="allvars_8h-source.html#l00025">TIMEBASE</a>, <a class="el" href="allvars_8h-source.html#l00358">global_data_all_processes::Timebase_interval</a>, <a class="el" href="system_8c-source.html#l00074">timediff()</a>, <a class="el" href="allvars_8h-source.html#l00253">global_data_all_processes::TotNumPart</a>, <a class="el" href="allvars_8h-source.html#l00433">global_data_all_processes::TreeDomainUpdateFrequency</a>, <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>, <a class="el" href="structNODE.html#o10">NODE::u</a>, <a class="el" href="allvars_8h-source.html#l00496">particle_data::Vel</a>, <a class="el" href="allvars_8h-source.html#l00544">sph_particle_data::VelPred</a>, and <a class="el" href="allvars_8h-source.html#l00600">extNODE::vs</a>.
<p>
Referenced by <a class="el" href="run_8c-source.html#l00020">run()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="timestep.c::find_dt_displacement_constraint"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void find_dt_displacement_constraint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hfac</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function computes an upper limit ('dt_displacement') to the global timestep of the system based on the rms velocities of particles. For cosmological simulations, the criterion used is that the rms displacement should be at most a fraction MaxRMSDisplacementFac of the mean particle separation. Note that the latter is estimated using the assigned particle masses, separately for each particle type. If comoving integration is not used, the function imposes no constraint on the timestep. <dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>hfac</em>&nbsp;</td><td>
should be a^2*H(a) </td></tr>
</table>
</dl>
<p>
Definition at line <a class="el" href="timestep_8c-source.html#l00582">582</a> of file <a class="el" href="timestep_8c-source.html">timestep.c</a>.
<p>
Referenced by <a class="el" href="timestep_8c-source.html#l00024">advance_and_find_timesteps()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="timestep.c::get_timestep"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int get_timestep           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double *&nbsp;</td>
          <td class="mdname" nowrap> <em>aphys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>flag</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function normally (for flag==0) returns the maximum allowed timestep of a particle, expressed in terms of the integer mapping that is used to represent the total simulated timespan. The physical acceleration is returned in `aphys'. The latter is used in conjunction with the PSEUDOSYMMETRIC integration option, which also makes of the second function of get_timestep. When it is called with a finite timestep for flag, it returns the physical acceleration that would lead to this timestep, assuming timestep criterion 0.<p>
&lt; adiabatic index of simulated gas <p>
&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 <dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>p</em>&nbsp;</td><td>
particle index </td></tr>
<tr><td valign="top"><em>aphys</em>&nbsp;</td><td>
acceleration (physical units) </td></tr>
<tr><td valign="top"><em>flag</em>&nbsp;</td><td>
either 0 for normal operation, or finite timestep to get corresponding aphys </td></tr>
</table>
</dl>
<p>
Definition at line <a class="el" href="timestep_8c-source.html#l00437">437</a> of file <a class="el" href="timestep_8c-source.html">timestep.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00497">particle_data::GravAccel</a>, <a class="el" href="allvars_8h-source.html#l00499">particle_data::GravPM</a>, <a class="el" href="allvars_8h-source.html#l00543">sph_particle_data::HydroAccel</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="timestep_8c-source.html#l00024">advance_and_find_timesteps()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:42 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
