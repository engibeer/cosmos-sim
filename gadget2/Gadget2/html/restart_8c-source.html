<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: restart.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>restart.c</h1><a href="restart_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
00004 <span class="preprocessor">#include &lt;math.h&gt;</span>
00005 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
00006 
00007 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00008 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00009 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00010 <span class="preprocessor">#include &lt;sys/file.h&gt;</span>
00011 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00012 <span class="preprocessor">#include &lt;gsl/gsl_rng.h&gt;</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="allvars_8h.html">allvars.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="proto_8h.html">proto.h</a>"</span>
00016 
00021 <span class="keyword">static</span> FILE *fd;
00022 
00023 <span class="keyword">static</span> <span class="keywordtype">void</span> in(<span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> modus);
00024 <span class="keyword">static</span> <span class="keywordtype">void</span> byten(<span class="keywordtype">void</span> *x, size_t n, <span class="keywordtype">int</span> modus);
00025 
00026 
<a name="l00035"></a><a class="code" href="restart_8c.html#a3">00035</a> <span class="keywordtype">void</span> <a class="code" href="restart_8c.html#a3">restart</a>(<span class="keywordtype">int</span> modus)
00036 {
00037   <span class="keywordtype">char</span> buf[200], buf_bak[200], buf_mv[500];
00038   <span class="keywordtype">double</span> save_PartAllocFactor, save_TreeAllocFactor;
00039   <span class="keywordtype">int</span> i, nprocgroup, masterTask, groupTask, old_MaxPart, old_MaxNodes;
00040   <span class="keyword">struct </span><a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a> all_task0;
00041 
00042 
00043   sprintf(buf, <span class="stringliteral">"%s%s.%d"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o121">RestartFile</a>, <a class="code" href="allvars_8c.html#a0">ThisTask</a>);
00044   sprintf(buf_bak, <span class="stringliteral">"%s%s.%d.bak"</span>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o115">OutputDir</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o121">RestartFile</a>, <a class="code" href="allvars_8c.html#a0">ThisTask</a>);
00045   sprintf(buf_mv, <span class="stringliteral">"mv %s %s"</span>, buf, buf_bak);
00046 
00047 
00048   <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a1">NTask</a> &lt; <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a>))
00049     {
00050       printf
00051         (<span class="stringliteral">"Fatal error.\nNumber of processors must be a smaller or equal than `NumFilesWrittenInParallel'.\n"</span>);
00052       <a class="code" href="proto_8h.html#a38">endrun</a>(2131);
00053     }
00054 
00055   nprocgroup = <a class="code" href="allvars_8c.html#a1">NTask</a> / <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a>;
00056 
00057   <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a1">NTask</a> % <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o8">NumFilesWrittenInParallel</a>))
00058     {
00059       nprocgroup++;
00060     }
00061 
00062   masterTask = (<a class="code" href="allvars_8c.html#a0">ThisTask</a> / nprocgroup) * nprocgroup;
00063 
00064   <span class="keywordflow">for</span>(groupTask = 0; groupTask &lt; nprocgroup; groupTask++)
00065     {
00066       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == (masterTask + groupTask))  <span class="comment">/* ok, it's this processor's turn */</span>
00067         {
00068           <span class="keywordflow">if</span>(modus)
00069             {
00070               <span class="keywordflow">if</span>(!(fd = fopen(buf, <span class="stringliteral">"r"</span>)))
00071                 {
00072                   printf(<span class="stringliteral">"Restart file '%s' not found.\n"</span>, buf);
00073                   <a class="code" href="proto_8h.html#a38">endrun</a>(7870);
00074                 }
00075             }
00076           <span class="keywordflow">else</span>
00077             {
00078               system(buf_mv);   <span class="comment">/* move old restart files to .bak files */</span>
00079 
00080               <span class="keywordflow">if</span>(!(fd = fopen(buf, <span class="stringliteral">"w"</span>)))
00081                 {
00082                   printf(<span class="stringliteral">"Restart file '%s' cannot be opened.\n"</span>, buf);
00083                   <a class="code" href="proto_8h.html#a38">endrun</a>(7878);
00084                 }
00085             }
00086 
00087 
00088           save_PartAllocFactor = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a>;
00089           save_TreeAllocFactor = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a>;
00090 
00091           <span class="comment">/* common data  */</span>
00092           byten(&amp;<a class="code" href="allvars_8c.html#a50">All</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a>), modus);
00093 
00094           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0">ThisTask</a> == 0 &amp;&amp; modus &gt; 0)
00095             all_task0 = All;
00096 
00097           <span class="keywordflow">if</span>(modus &gt; 0 &amp;&amp; groupTask == 0)       <span class="comment">/* read */</span>
00098             {
00099               MPI_Bcast(&amp;all_task0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> global_data_all_processes), MPI_BYTE, 0, MPI_COMM_WORLD);
00100             }
00101 
00102           old_MaxPart = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>;
00103           old_MaxNodes = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>;
00104 
00105           <span class="keywordflow">if</span>(modus)             <span class="comment">/* read */</span>
00106             {
00107               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a> != save_PartAllocFactor)
00108                 {
00109                   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a> = save_PartAllocFactor;
00110                   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> / NTask);
00111                   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o3">MaxPartSph</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o1">TotN_gas</a> / NTask);
00112                   save_PartAllocFactor = -1;
00113                 }
00114 
00115               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a> != save_TreeAllocFactor)
00116                 {
00117                   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a> = save_TreeAllocFactor;
00118                   save_TreeAllocFactor = -1;
00119                 }
00120 
00121               <span class="keywordflow">if</span>(all_task0.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a> != <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o54">Time</a>)
00122                 {
00123                   printf(<span class="stringliteral">"The restart file on task=%d is not consistent with the one on task=0\n"</span>, <a class="code" href="allvars_8c.html#a0">ThisTask</a>);
00124                   fflush(stdout);
00125                   <a class="code" href="proto_8h.html#a38">endrun</a>(16);
00126                 }
00127 
00128               <a class="code" href="allocate_8c.html#a1">allocate_memory</a>();
00129             }
00130 
00131           in(&amp;<a class="code" href="allvars_8c.html#a3">NumPart</a>, modus);
00132 
00133           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a3">NumPart</a> &gt; <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>)
00134             {
00135               printf
00136                 (<span class="stringliteral">"it seems you have reduced(!) 'PartAllocFactor' below the value of %g needed to load the restart file.\n"</span>,
00137                  <a class="code" href="allvars_8c.html#a3">NumPart</a> / (((double) <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a>) / NTask));
00138               printf(<span class="stringliteral">"fatal error\n"</span>);
00139               <a class="code" href="proto_8h.html#a38">endrun</a>(22);
00140             }
00141 
00142           <span class="comment">/* Particle data  */</span>
00143           byten(&amp;<a class="code" href="allvars_8c.html#a51">P</a>[0], <a class="code" href="allvars_8c.html#a3">NumPart</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>), modus);
00144 
00145           in(&amp;<a class="code" href="allvars_8c.html#a4">N_gas</a>, modus);
00146 
00147           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a4">N_gas</a> &gt; 0)
00148             {
00149               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a4">N_gas</a> &gt; <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o3">MaxPartSph</a>)
00150                 {
00151                   printf
00152                     (<span class="stringliteral">"SPH: it seems you have reduced(!) 'PartAllocFactor' below the value of %g needed to load the restart file.\n"</span>,
00153                      <a class="code" href="allvars_8c.html#a4">N_gas</a> / (((double) <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o1">TotN_gas</a>) / NTask));
00154                   printf(<span class="stringliteral">"fatal error\n"</span>);
00155                   <a class="code" href="proto_8h.html#a38">endrun</a>(222);
00156                 }
00157               <span class="comment">/* Sph-Particle data  */</span>
00158               byten(&amp;<a class="code" href="allvars_8c.html#a53">SphP</a>[0], <a class="code" href="allvars_8c.html#a4">N_gas</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsph__particle__data.html">sph_particle_data</a>), modus);
00159             }
00160 
00161           <span class="comment">/* write state of random number generator */</span>
00162           byten(gsl_rng_state(<a class="code" href="allvars_8c.html#a15">random_generator</a>), gsl_rng_size(<a class="code" href="allvars_8c.html#a15">random_generator</a>), modus);
00163 
00164 
00165           <span class="comment">/* now store relevant data for tree */</span>
00166 
00167           <span class="keywordflow">if</span>(modus)             <span class="comment">/* read */</span>
00168             {
00169               <a class="code" href="proto_8h.html#a110">ngb_treeallocate</a>(<a class="code" href="allvars_8h.html#a31">MAX_NGB</a>);
00170 
00171               <a class="code" href="proto_8h.html#a57">force_treeallocate</a>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>, <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>);
00172             }
00173 
00174 
00175           in(&amp;<a class="code" href="allvars_8c.html#a56">Numnodestree</a>, modus);
00176 
00177           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a56">Numnodestree</a> &gt; MaxNodes)
00178             {
00179               printf
00180                 (<span class="stringliteral">"Tree storage: it seems you have reduced(!) 'PartAllocFactor' below the value needed to load the restart file (task=%d). "</span>
00181                  <span class="stringliteral">"Numnodestree=%d  MaxNodes=%d\n"</span>, ThisTask, Numnodestree, MaxNodes);
00182               <a class="code" href="proto_8h.html#a38">endrun</a>(221);
00183             }
00184 
00185           byten(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>, <a class="code" href="allvars_8c.html#a56">Numnodestree</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>), modus);
00186           byten(<a class="code" href="allvars_8c.html#a61">Extnodes_base</a>, <a class="code" href="allvars_8c.html#a56">Numnodestree</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structextNODE.html">extNODE</a>), modus);
00187 
00188           byten(<a class="code" href="allvars_8c.html#a60">Father</a>, <a class="code" href="allvars_8c.html#a3">NumPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00189 
00190           byten(<a class="code" href="allvars_8c.html#a59">Nextnode</a>, <a class="code" href="allvars_8c.html#a3">NumPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00191           byten(<a class="code" href="allvars_8c.html#a59">Nextnode</a> + <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>, <a class="code" href="allvars_8h.html#a2">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00192 
00193           byten(<a class="code" href="allvars_8c.html#a23">DomainStartList</a>, <a class="code" href="allvars_8c.html#a1">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00194           byten(<a class="code" href="allvars_8c.html#a24">DomainEndList</a>, <a class="code" href="allvars_8c.html#a1">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00195           byten(<a class="code" href="allvars_8c.html#a28">DomainTask</a>, <a class="code" href="allvars_8h.html#a2">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00196           byten(<a class="code" href="allvars_8c.html#a29">DomainNodeIndex</a>, <a class="code" href="allvars_8h.html#a2">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00197           byten(<a class="code" href="allvars_8c.html#a30">DomainTreeNodeLen</a>, <a class="code" href="allvars_8h.html#a2">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<a class="code" href="allvars_8h.html#a35">FLOAT</a>), modus);
00198           byten(<a class="code" href="allvars_8c.html#a31">DomainHmax</a>, <a class="code" href="allvars_8h.html#a2">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<a class="code" href="allvars_8h.html#a35">FLOAT</a>), modus);
00199           byten(<a class="code" href="allvars_8c.html#a32">DomainMoment</a>, <a class="code" href="allvars_8h.html#a2">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structDomainNODE.html">DomainNODE</a>), modus);
00200 
00201           byten(<a class="code" href="allvars_8c.html#a17">DomainCorner</a>, 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
00202           byten(<a class="code" href="allvars_8c.html#a18">DomainCenter</a>, 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
00203           byten(&amp;<a class="code" href="allvars_8c.html#a19">DomainLen</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
00204           byten(&amp;<a class="code" href="allvars_8c.html#a20">DomainFac</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
00205           byten(&amp;<a class="code" href="allvars_8c.html#a21">DomainMyStart</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00206           byten(&amp;<a class="code" href="allvars_8c.html#a22">DomainMyLast</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
00207 
00208           <span class="keywordflow">if</span>(modus)             <span class="comment">/* read */</span>
00209             <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o14">PartAllocFactor</a> != save_PartAllocFactor || <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o15">TreeAllocFactor</a> != save_TreeAllocFactor)
00210               {
00211                 <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00212                   <a class="code" href="allvars_8c.html#a60">Father</a>[i] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00213 
00214                 <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00215                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a59">Nextnode</a>[i] &gt;= old_MaxPart)
00216                     {
00217                       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a59">Nextnode</a>[i] &gt;= old_MaxPart + old_MaxNodes)
00218                         <a class="code" href="allvars_8c.html#a59">Nextnode</a>[i] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#a55">MaxNodes</a> - old_MaxPart);
00219                       <span class="keywordflow">else</span>
00220                         <a class="code" href="allvars_8c.html#a59">Nextnode</a>[i] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00221                     }
00222 
00223                 <span class="keywordflow">for</span>(i = 0; i &lt; Numnodestree; i++)
00224                   {
00225                     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o6">sibling</a> &gt;= old_MaxPart)
00226                       {
00227                         <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o6">sibling</a> &gt;= old_MaxPart + old_MaxNodes)
00228                           <a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o6">sibling</a> +=
00229                             (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#a55">MaxNodes</a> - old_MaxNodes);
00230                         <span class="keywordflow">else</span>
00231                           <a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o6">sibling</a> += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00232                       }
00233 
00234                     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o8">father</a> &gt;= old_MaxPart)
00235                       {
00236                         <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o8">father</a> &gt;= old_MaxPart + old_MaxNodes)
00237                           <a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o8">father</a> += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#a55">MaxNodes</a> - old_MaxNodes);
00238                         <span class="keywordflow">else</span>
00239                           <a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o8">father</a> += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00240                       }
00241 
00242                     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o7">nextnode</a> &gt;= old_MaxPart)
00243                       {
00244                         <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o7">nextnode</a> &gt;= old_MaxPart + old_MaxNodes)
00245                           <a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o7">nextnode</a> +=
00246                             (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#a55">MaxNodes</a> - old_MaxNodes);
00247                         <span class="keywordflow">else</span>
00248                           <a class="code" href="allvars_8c.html#a57">Nodes_base</a>[i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o7">nextnode</a> += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00249                       }
00250                   }
00251 
00252                 <span class="keywordflow">for</span>(i = 0; i &lt; MAXTOPNODES; i++)
00253                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a59">Nextnode</a>[i + <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>] &gt;= old_MaxPart)
00254                     {
00255                       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a59">Nextnode</a>[i + <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>] &gt;= old_MaxPart + old_MaxNodes)
00256                         <a class="code" href="allvars_8c.html#a59">Nextnode</a>[i + <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#a55">MaxNodes</a> - old_MaxNodes);
00257                       <span class="keywordflow">else</span>
00258                         <a class="code" href="allvars_8c.html#a59">Nextnode</a>[i + <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a>] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00259                     }
00260 
00261                 <span class="keywordflow">for</span>(i = 0; i &lt; MAXTOPNODES; i++)
00262                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29">DomainNodeIndex</a>[i] &gt;= old_MaxPart)
00263                     {
00264                       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29">DomainNodeIndex</a>[i] &gt;= old_MaxPart + old_MaxNodes)
00265                         <a class="code" href="allvars_8c.html#a29">DomainNodeIndex</a>[i] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#a55">MaxNodes</a> - old_MaxNodes);
00266                       <span class="keywordflow">else</span>
00267                         <a class="code" href="allvars_8c.html#a29">DomainNodeIndex</a>[i] += (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> - old_MaxPart);
00268                     }
00269               }
00270 
00271           fclose(fd);
00272         }
00273       <span class="keywordflow">else</span>                      <span class="comment">/* wait inside the group */</span>
00274         {
00275           <span class="keywordflow">if</span>(modus &gt; 0 &amp;&amp; groupTask == 0)       <span class="comment">/* read */</span>
00276             {
00277               MPI_Bcast(&amp;all_task0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a>), MPI_BYTE, 0, MPI_COMM_WORLD);
00278             }
00279         }
00280 
00281       MPI_Barrier(MPI_COMM_WORLD);
00282     }
00283 }
00284 
00285 
00286 
00289 <span class="keywordtype">void</span> byten(<span class="keywordtype">void</span> *x, size_t n, <span class="keywordtype">int</span> modus)
00290 {
00291   <span class="keywordflow">if</span>(modus)
00292     <a class="code" href="proto_8h.html#a107">my_fread</a>(x, n, 1, fd);
00293   <span class="keywordflow">else</span>
00294     <a class="code" href="proto_8h.html#a108">my_fwrite</a>(x, n, 1, fd);
00295 }
00296 
00297 
00300 <span class="keywordtype">void</span> in(<span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> modus)
00301 {
00302   <span class="keywordflow">if</span>(modus)
00303     <a class="code" href="proto_8h.html#a107">my_fread</a>(x, 1, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), fd);
00304   <span class="keywordflow">else</span>
00305     <a class="code" href="proto_8h.html#a108">my_fwrite</a>(x, 1, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), fd);
00306 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:41 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
