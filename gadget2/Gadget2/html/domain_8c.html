<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: domain.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>domain.c File Reference</h1>code for domain decomposition <a href="#_details">More...</a>
<p>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;mpi.h&gt;</code><br>
<code>#include "<a class="el" href="allvars_8h-source.html">allvars.h</a>"</code><br>
<code>#include "<a class="el" href="proto_8h-source.html">proto.h</a>"</code><br>

<p>
<a href="domain_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><b>topnode_exchange</b></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a0">TOPNODEFACTOR</a>&nbsp;&nbsp;&nbsp;20.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a1">REDUC_FAC</a>&nbsp;&nbsp;&nbsp;0.98</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a15">domain_Decomposition</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a16">domain_decompose</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a17">domain_findSplit</a> (int cpustart, int ncpu, int first, int last)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a18">domain_shiftSplit</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a19">domain_findExchangeNumbers</a> (int task, int partner, int sphflag, int *send, int *recv)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a20">domain_exchangeParticles</a> (int partner, int sphflag, int send_count, int recv_count)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a21">domain_countToGo</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a22">domain_walktoptree</a> (int no)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a23">domain_sumCost</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a24">domain_findExtent</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a25">domain_determineTopTree</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a26">domain_topsplit_local</a> (int node, <a class="el" href="allvars_8h.html#a45">peanokey</a> startkey)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a27">domain_topsplit</a> (int node, <a class="el" href="allvars_8h.html#a45">peanokey</a> startkey)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a28">domain_compare_toplist</a> (const void *a, const void *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="domain_8c.html#a29">domain_compare_key</a> (const void *a, const void *b)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
code for domain decomposition 
<p>
This file contains the code for the domain decomposition of the simulation volume. The domains are constructed from disjoint subsets of the leaves of a fiducial top-level tree that covers the full simulation volume. Domain boundaries hence run along tree-node divisions of a fiducial global BH tree. As a result of this method, the tree force are in principle strictly independent of the way the domains are cut. The domain decomposition can be carried out for an arbitrary number of CPUs. Individual domains are not cubical, but spatially coherent since the leaves are traversed in a Peano-Hilbert order and individual domains form segments along this order. This also ensures that each domain has a small surface to volume ratio, which minimizes communication.
<p>
Definition in file <a class="el" href="domain_8c-source.html">domain.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="domain.c::REDUC_FAC"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define REDUC_FAC&nbsp;&nbsp;&nbsp;0.98          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="domain_8c-source.html#l00031">31</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="domain.c::TOPNODEFACTOR"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define TOPNODEFACTOR&nbsp;&nbsp;&nbsp;20.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="domain_8c-source.html#l00029">29</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a29" doxytag="domain.c::domain_compare_key"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int domain_compare_key           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>b</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This is a comparison kernel used in a sort routine. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l01127">1127</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="domain.c::domain_compare_toplist"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int domain_compare_toplist           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>b</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This is a comparison kernel used in a sort routine. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l01114">1114</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="domain.c::domain_countToGo"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_countToGo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function determines how many particles that are currently stored on the local CPU have to be moved off according to the domain decomposition. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00729">729</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="allvars_8c-source.html#l00058">DomainTask</a>, <a class="el" href="allvars_8c-source.html#l00068">Key</a>, <a class="el" href="allvars_8h-source.html#l00211">topnode_data::Leaf</a>, <a class="el" href="allvars_8c-source.html#l00012">NTask</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00212">topnode_data::Size</a>, <a class="el" href="allvars_8h-source.html#l00213">topnode_data::StartKey</a>, <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="domain.c::domain_decompose"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_decompose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function carries out the actual domain decomposition for all particle types. It will try to balance the work-load for each domain, as estimated based on the P[i]-GravCost values. The decomposition will respect the maximum allowed memory-imbalance given by the value of PartAllocFactor. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00154">154</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="domain_8c-source.html#l00729">domain_countToGo()</a>, <a class="el" href="domain_8c-source.html#l00898">domain_determineTopTree()</a>, <a class="el" href="domain_8c-source.html#l00595">domain_exchangeParticles()</a>, <a class="el" href="domain_8c-source.html#l00534">domain_findExchangeNumbers()</a>, <a class="el" href="domain_8c-source.html#l00845">domain_findExtent()</a>, <a class="el" href="domain_8c-source.html#l00327">domain_findSplit()</a>, <a class="el" href="domain_8c-source.html#l00447">domain_shiftSplit()</a>, <a class="el" href="domain_8c-source.html#l00786">domain_sumCost()</a>, <a class="el" href="allvars_8c-source.html#l00053">DomainEndList</a>, <a class="el" href="allvars_8c-source.html#l00051">DomainMyLast</a>, <a class="el" href="allvars_8c-source.html#l00050">DomainMyStart</a>, <a class="el" href="allvars_8c-source.html#l00052">DomainStartList</a>, <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c-source.html#l00012">NTask</a>, <a class="el" href="allvars_8c-source.html#l00073">NTopleaves</a>, <a class="el" href="allvars_8c-source.html#l00017">Ntype</a>, <a class="el" href="allvars_8c-source.html#l00018">NtypeLocal</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00458">global_data_all_processes::SofteningTable</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h-source.html#l00254">global_data_all_processes::TotN_gas</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00062">domain_Decomposition()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="domain.c::domain_Decomposition"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_Decomposition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This is the main routine for the domain decomposition. It acts as a driver routine that allocates various temporary buffers, maps the particles back onto the periodic box if needed, and then does the domain decomposition, and a final Peano-Hilbert order of all particles as a tuning measure. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00062">62</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00391">global_data_all_processes::CPU_Domain</a>, <a class="el" href="allvars_8h-source.html#l00404">global_data_all_processes::CPU_Peano</a>, <a class="el" href="predict_8c-source.html#l00103">do_box_wrapping()</a>, <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>, <a class="el" href="allvars_8c-source.html#l00068">Key</a>, <a class="el" href="allvars_8c-source.html#l00069">KeySorted</a>, <a class="el" href="allvars_8h-source.html#l00256">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8h-source.html#l00257">global_data_all_processes::MaxPartSph</a>, <a class="el" href="allvars_8c-source.html#l00016">N_gas</a>, <a class="el" href="allvars_8c-source.html#l00012">NTask</a>, <a class="el" href="allvars_8h-source.html#l00297">global_data_all_processes::NumForcesSinceLastDomainDecomp</a>, <a class="el" href="allvars_8c-source.html#l00015">NumPart</a>, <a class="el" href="peano_8c-source.html#l00034">peano_hilbert_order()</a>, <a class="el" href="allvars_8h-source.html#l00032">peanokey</a>, <a class="el" href="allvars_8h-source.html#l00366">global_data_all_processes::PM_Ti_endstep</a>, <a class="el" href="system_8c-source.html#l00053">second()</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h-source.html#l00359">global_data_all_processes::Ti_Current</a>, <a class="el" href="system_8c-source.html#l00074">timediff()</a>, <a class="el" href="allvars_8h-source.html#l00253">global_data_all_processes::TotNumPart</a>, <a class="el" href="allvars_8h-source.html#l00433">global_data_all_processes::TreeDomainUpdateFrequency</a>, and <a class="el" href="allvars_8c-source.html#l00034">TreeReconstructFlag</a>.
<p>
Referenced by <a class="el" href="init_8c-source.html#l00020">init()</a>, and <a class="el" href="run_8c-source.html#l00020">run()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="domain.c::domain_determineTopTree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_determineTopTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function constructs the global top-level tree node that is used for the domain decomposition. This is done by considering the string of Peano-Hilbert keys for all particles, which is recursively chopped off in pieces of eight segments until each segment holds at most a certain number of particles.<p>
&lt; Bits per dimension available for Peano-Hilbert order. Note: If peanokey is defined as type int, the allowed maximum is 10. If 64-bit integers are used, the maximum is 21 <p>
&lt; Bits per dimension available for Peano-Hilbert order. Note: If peanokey is defined as type int, the allowed maximum is 10. If 64-bit integers are used, the maximum is 21 <p>
&lt; The number of different Peano-Hilbert cells <p>
&lt; Bits per dimension available for Peano-Hilbert order. Note: If peanokey is defined as type int, the allowed maximum is 10. If 64-bit integers are used, the maximum is 21 <p>
&lt; The number of different Peano-Hilbert cells 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00898">898</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00034">BITS_PER_DIMENSION</a>, <a class="el" href="allvars_8c-source.html#l00046">DomainCorner</a>, <a class="el" href="allvars_8c-source.html#l00049">DomainFac</a>, <a class="el" href="allvars_8c-source.html#l00068">Key</a>, <a class="el" href="allvars_8c-source.html#l00069">KeySorted</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, and <a class="el" href="peano_8c-source.html#l00263">peano_hilbert_key()</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="domain.c::domain_exchangeParticles"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_exchangeParticles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>partner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sphflag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>send_count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>recv_count</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function exchanges particles between two CPUs according to the domain split. In doing this, the memory boundaries which may restrict the exhange process are observed. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00595">595</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="allvars_8c-source.html#l00066">DomainKeyBuf</a>, <a class="el" href="allvars_8c-source.html#l00119">DomainPartBuf</a>, <a class="el" href="allvars_8c-source.html#l00127">DomainSphBuf</a>, <a class="el" href="allvars_8c-source.html#l00058">DomainTask</a>, <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c-source.html#l00068">Key</a>, <a class="el" href="allvars_8h-source.html#l00211">topnode_data::Leaf</a>, <a class="el" href="allvars_8c-source.html#l00016">N_gas</a>, <a class="el" href="allvars_8c-source.html#l00015">NumPart</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00032">peanokey</a>, <a class="el" href="allvars_8h-source.html#l00212">topnode_data::Size</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, <a class="el" href="allvars_8h-source.html#l00213">topnode_data::StartKey</a>, <a class="el" href="tags_8h-source.html#l00009">TAG_KEY</a>, <a class="el" href="tags_8h-source.html#l00007">TAG_PDATA</a>, <a class="el" href="tags_8h-source.html#l00008">TAG_SPHDATA</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="domain.c::domain_findExchangeNumbers"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_findExchangeNumbers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>task</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>partner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sphflag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>send</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>recv</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function counts how many particles have to be exchanged between two CPUs according to the domain split. If the CPUs are already quite full and hold data from other CPUs as well, not all the particles may be exchanged at once. In this case the communication phase has to be repeated, until enough of the third-party particles have been moved away such that the decomposition can be completed. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00534">534</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00273">global_data_all_processes::BunchSizeDomain</a>, <a class="el" href="system_8c-source.html#l00125">imin()</a>, <a class="el" href="allvars_8h-source.html#l00256">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8h-source.html#l00257">global_data_all_processes::MaxPartSph</a>, and <a class="el" href="allvars_8c-source.html#l00012">NTask</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="domain.c::domain_findExtent"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_findExtent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This routine finds the extent of the global domain grid.<p>
&lt; Bits per dimension available for Peano-Hilbert order. Note: If peanokey is defined as type int, the allowed maximum is 10. If 64-bit integers are used, the maximum is 21 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00845">845</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00047">DomainCenter</a>, <a class="el" href="allvars_8c-source.html#l00046">DomainCorner</a>, <a class="el" href="allvars_8c-source.html#l00049">DomainFac</a>, <a class="el" href="allvars_8c-source.html#l00048">DomainLen</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, and <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="domain.c::domain_findSplit"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int domain_findSplit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>cpustart</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>ncpu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>first</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>last</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function tries to find a split point in a range of cells in the domain-grid. The range of cells starts at 'first', and ends at 'last' (inclusively). The number of cpus that holds the range is 'ncpu', with the first cpu given by 'cpustart'. If more than 2 cpus are to be split, the function calls itself recursively. The division tries to achieve a best particle-load balance under the constraint that 'maxload' and 'maxloadsph' may not be exceeded, and that each cpu holds at least one cell from the domaingrid. If such a decomposition cannot be achieved, a non-zero error code is returned.<p>
After successful completion, DomainMyStart[] and DomainMyLast[] contain the first and last cell of the domaingrid assigned to the local task for the given type. Also, DomainTask[] contains for each cell the task it was assigned to. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00327">327</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="system_8c-source.html#l00095">dmax()</a>, <a class="el" href="allvars_8c-source.html#l00055">DomainCount</a>, <a class="el" href="allvars_8c-source.html#l00056">DomainCountSph</a>, <a class="el" href="allvars_8c-source.html#l00053">DomainEndList</a>, <a class="el" href="allvars_8c-source.html#l00052">DomainStartList</a>, and <a class="el" href="allvars_8c-source.html#l00058">DomainTask</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="domain.c::domain_shiftSplit"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_shiftSplit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function tries to improve the domain decomposition found by <a class="el" href="domain_8c.html#a17">domain_findSplit()</a> with respect to work-load balance. To this end, the boundaries in the existing domain-split solution (which was found by trying to balance the particle load) are shifted as long as this leads to better work-load while still remaining within the allowed memory-imbalance constraints. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00447">447</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="system_8c-source.html#l00095">dmax()</a>, <a class="el" href="allvars_8c-source.html#l00055">DomainCount</a>, <a class="el" href="allvars_8c-source.html#l00056">DomainCountSph</a>, <a class="el" href="allvars_8c-source.html#l00053">DomainEndList</a>, <a class="el" href="allvars_8c-source.html#l00052">DomainStartList</a>, <a class="el" href="allvars_8c-source.html#l00058">DomainTask</a>, <a class="el" href="allvars_8c-source.html#l00054">DomainWork</a>, and <a class="el" href="allvars_8c-source.html#l00012">NTask</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="domain.c::domain_sumCost"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_sumCost           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This routine bins the particles onto the domain-grid, i.e. it sums up the total number of particles and the total amount of work in each of the domain-cells. This information forms the basis for the actual decision on the adopted domain decomposition. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00786">786</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="domain_8c-source.html#l00765">domain_walktoptree()</a>, <a class="el" href="allvars_8c-source.html#l00055">DomainCount</a>, <a class="el" href="allvars_8c-source.html#l00056">DomainCountSph</a>, <a class="el" href="allvars_8c-source.html#l00054">DomainWork</a>, <a class="el" href="allvars_8h-source.html#l00518">particle_data::GravCost</a>, <a class="el" href="allvars_8c-source.html#l00068">Key</a>, <a class="el" href="allvars_8h-source.html#l00211">topnode_data::Leaf</a>, <a class="el" href="allvars_8c-source.html#l00073">NTopleaves</a>, <a class="el" href="allvars_8c-source.html#l00072">NTopnodes</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00212">topnode_data::Size</a>, <a class="el" href="allvars_8h-source.html#l00213">topnode_data::StartKey</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h-source.html#l00514">particle_data::Ti_begstep</a>, <a class="el" href="allvars_8h-source.html#l00513">particle_data::Ti_endstep</a>, <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00154">domain_decompose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="domain.c::domain_topsplit"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_topsplit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="allvars_8h.html#a45">peanokey</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>startkey</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is responsible for constructing the global top-level tree segments. Starting from a joint list of all local top-level segments, in which mulitple occurences of the same spatial segment have been combined, a segment is subdivided into 8 pieces recursively until the number of particles in each segment has fallen below All.TotNumPart / (TOPNODEFACTOR * NTask).<p>
&lt; Maximum number of nodes in the top-level tree used for domain decomposition 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l01057">1057</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00210">topnode_data::Blocks</a>, <a class="el" href="allvars_8h-source.html#l00214">topnode_data::Count</a>, <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c-source.html#l00072">NTopnodes</a>, <a class="el" href="allvars_8h-source.html#l00209">topnode_data::Pstart</a>, <a class="el" href="allvars_8h-source.html#l00212">topnode_data::Size</a>, <a class="el" href="allvars_8h-source.html#l00213">topnode_data::StartKey</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, and <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="domain.c::domain_topsplit_local"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_topsplit_local           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="allvars_8h.html#a45">peanokey</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>startkey</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is responsible for constructing the local top-level Peano-Hilbert segments. A segment is cut into 8 pieces recursively until the number of particles in the segment has fallen below All.TotNumPart / (TOPNODEFACTOR * NTask * NTask).<p>
&lt; Maximum number of nodes in the top-level tree used for domain decomposition 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00990">990</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00214">topnode_data::Count</a>, <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c-source.html#l00072">NTopnodes</a>, <a class="el" href="allvars_8h-source.html#l00209">topnode_data::Pstart</a>, <a class="el" href="allvars_8h-source.html#l00212">topnode_data::Size</a>, <a class="el" href="allvars_8h-source.html#l00213">topnode_data::StartKey</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, and <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="domain.c::domain_walktoptree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void domain_walktoptree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>no</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function walks the global top tree in order to establish the number of leaves it has. These leaves are distributed to different processors. 
<p>
Definition at line <a class="el" href="domain_8c-source.html#l00765">765</a> of file <a class="el" href="domain_8c-source.html">domain.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="allvars_8h-source.html#l00211">topnode_data::Leaf</a>, <a class="el" href="allvars_8c-source.html#l00073">NTopleaves</a>, and <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>.
<p>
Referenced by <a class="el" href="domain_8c-source.html#l00786">domain_sumCost()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:41 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
