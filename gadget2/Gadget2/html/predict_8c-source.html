<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: predict.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>predict.c</h1><a href="predict_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
00004 <span class="preprocessor">#include &lt;math.h&gt;</span>
00005 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
00006 <span class="preprocessor">#include &lt;gsl/gsl_math.h&gt;</span>
00007 
00008 <span class="preprocessor">#include "<a class="code" href="allvars_8h.html">allvars.h</a>"</span>
00009 <span class="preprocessor">#include "<a class="code" href="proto_8h.html">proto.h</a>"</span>
00010 
00011 
<a name="l00031"></a><a class="code" href="proto_8h.html#a106">00031</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#a106">move_particles</a>(<span class="keywordtype">int</span> time0, <span class="keywordtype">int</span> time1)
00032 {
00033   <span class="keywordtype">int</span> i, j;
00034   <span class="keywordtype">double</span> dt_drift, dt_gravkick, dt_hydrokick, dt_entr;
00035   <span class="keywordtype">double</span> t0, t1;
00036 
00037 
00038   t0 = <a class="code" href="proto_8h.html#a145">second</a>();
00039 
00040   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o40">ComovingIntegrationOn</a>)
00041     {
00042       dt_drift = <a class="code" href="proto_8h.html#a82">get_drift_factor</a>(time0, time1);
00043       dt_gravkick = <a class="code" href="proto_8h.html#a83">get_gravkick_factor</a>(time0, time1);
00044       dt_hydrokick = <a class="code" href="proto_8h.html#a84">get_hydrokick_factor</a>(time0, time1);
00045     }
00046   <span class="keywordflow">else</span>
00047     {
00048       dt_drift = dt_gravkick = dt_hydrokick = (time1 - time0) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a>;
00049     }
00050 
00051   <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00052     {
00053       <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00054         <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o0">Pos</a>[j] += <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o2">Vel</a>[j] * dt_drift;
00055 
00056       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o9">Type</a> == 0)
00057         {
00058 <span class="preprocessor">#ifdef PMGRID</span>
00059 <span class="preprocessor"></span>          <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00060             <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o9">VelPred</a>[j] +=
00061               (<a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o3">GravAccel</a>[j] + <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o4">GravPM</a>[j]) * dt_gravkick + <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o8">HydroAccel</a>[j] * dt_hydrokick;
00062 <span class="preprocessor">#else</span>
00063 <span class="preprocessor"></span>          <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00064             <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o9">VelPred</a>[j] += <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o3">GravAccel</a>[j] * dt_gravkick + <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o8">HydroAccel</a>[j] * dt_hydrokick;
00065 <span class="preprocessor">#endif</span>
00066 <span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o1">Density</a> *= exp(-<a class="code" href="allvars_8c.html#a53">SphP</a>[i].DivVel * dt_drift);
00067           <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o2">Hsml</a> *= exp(0.333333333333 * <a class="code" href="allvars_8c.html#a53">SphP</a>[i].DivVel * dt_drift);
00068 
00069           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o2">Hsml</a> &lt; <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o98">MinGasHsml</a>)
00070             <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o2">Hsml</a> = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o98">MinGasHsml</a>;
00071 
00072           dt_entr = (<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o59">Ti_Current</a> - (<a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o11">Ti_begstep</a> + <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o10">Ti_endstep</a>) / 2) * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o58">Timebase_interval</a>;
00073 
00074           <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o6">Pressure</a> = (<a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o0">Entropy</a> + <a class="code" href="allvars_8c.html#a53">SphP</a>[i].<a class="code" href="structsph__particle__data.html#o7">DtEntropy</a> * dt_entr) * <a class="code" href="proto_8h.html#a133">pow</a>(<a class="code" href="allvars_8c.html#a53">SphP</a>[i].Density, <a class="code" href="allvars_8h.html#a9">GAMMA</a>);
00075         }
00076     }
00077 
00078   <span class="comment">/* if domain-decomp and tree are not going to be reconstructed, update dynamically.  */</span>
00079   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o23">NumForcesSinceLastDomainDecomp</a> &lt; <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o0">TotNumPart</a> * <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o96">TreeDomainUpdateFrequency</a>)
00080     {
00081       <span class="keywordflow">for</span>(i = 0; i &lt; Numnodestree; i++)
00082         <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00083           <a class="code" href="allvars_8c.html#a58">Nodes</a>[<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> + i].<a class="code" href="structNODE.html#o10">u</a>.<a class="code" href="structNODE.html#o9">d</a>.<a class="code" href="structNODE.html#o3">s</a>[j] += <a class="code" href="allvars_8c.html#a62">Extnodes</a>[<a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o2">MaxPart</a> + i].<a class="code" href="structextNODE.html#o1">vs</a>[j] * dt_drift;
00084 
00085       <a class="code" href="forcetree_8c.html#a22">force_update_len</a>();
00086 
00087       <a class="code" href="forcetree_8c.html#a18">force_update_pseudoparticles</a>();
00088     }
00089 
00090   t1 = <a class="code" href="proto_8h.html#a145">second</a>();
00091 
00092   <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o85">CPU_Predict</a> += <a class="code" href="system_8c.html#a3">timediff</a>(t0, t1);
00093 }
00094 
00095 
00096 
00102 <span class="preprocessor">#ifdef PERIODIC</span>
<a name="l00103"></a><a class="code" href="proto_8h.html#a20">00103</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="predict_8c.html#a1">do_box_wrapping</a>(<span class="keywordtype">void</span>)
00104 {
00105   <span class="keywordtype">int</span> i, j;
00106   <span class="keywordtype">double</span> boxsize[3];
00107 
00108   <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00109     boxsize[j] = <a class="code" href="allvars_8c.html#a50">All</a>.<a class="code" href="structglobal__data__all__processes.html#o4">BoxSize</a>;
00110 
00111 <span class="preprocessor">#ifdef LONG_X</span>
00112 <span class="preprocessor"></span>  boxsize[0] *= LONG_X;
00113 <span class="preprocessor">#endif</span>
00114 <span class="preprocessor"></span><span class="preprocessor">#ifdef LONG_Y</span>
00115 <span class="preprocessor"></span>  boxsize[1] *= LONG_Y;
00116 <span class="preprocessor">#endif</span>
00117 <span class="preprocessor"></span><span class="preprocessor">#ifdef LONG_Z</span>
00118 <span class="preprocessor"></span>  boxsize[2] *= LONG_Z;
00119 <span class="preprocessor">#endif</span>
00120 <span class="preprocessor"></span>
00121   <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
00122     <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
00123       {
00124         <span class="keywordflow">while</span>(<a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o0">Pos</a>[j] &lt; 0)
00125           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o0">Pos</a>[j] += boxsize[j];
00126 
00127         <span class="keywordflow">while</span>(<a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o0">Pos</a>[j] &gt;= boxsize[j])
00128           <a class="code" href="allvars_8c.html#a51">P</a>[i].<a class="code" href="structparticle__data.html#o0">Pos</a>[j] -= boxsize[j];
00129       }
00130 }
00131 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:41 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
