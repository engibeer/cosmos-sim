<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: forcetree.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>forcetree.c File Reference</h1>gravitational tree and code for Ewald correction <a href="#_details">More...</a>
<p>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;mpi.h&gt;</code><br>
<code>#include "<a class="el" href="allvars_8h-source.html">allvars.h</a>"</code><br>
<code>#include "<a class="el" href="proto_8h-source.html">proto.h</a>"</code><br>

<p>
<a href="forcetree_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a0">NTAB</a>&nbsp;&nbsp;&nbsp;1000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a1">NEAREST</a>(x)&nbsp;&nbsp;&nbsp;(((x)&gt;boxhalf)?((x)-boxsize):(((x)&lt;-boxhalf)?((x)+boxsize):(x)))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a2">EN</a>&nbsp;&nbsp;&nbsp;64</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a13">force_treebuild</a> (int npart)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a14">force_treebuild_single</a> (int npart)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a15">force_create_empty_nodes</a> (int no, int topnode, int bits, int x, int y, int z, int *nodecount, int *nextfree)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a16">force_insert_pseudo_particles</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a17">force_update_node_recursive</a> (int no, int sib, int father)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a18">force_update_pseudoparticles</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a19">force_exchange_pseudodata</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a20">force_treeupdate_pseudos</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a21">force_flag_localnodes</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a22">force_update_len</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a23">force_update_node_len_local</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a24">force_update_node_len_toptree</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a25">force_update_hmax</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a26">force_update_node_hmax_local</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a27">force_update_node_hmax_toptree</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a28">force_treeevaluate</a> (int target, int mode, double *ewaldcountsum)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a29">force_treeevaluate_shortrange</a> (int target, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a30">force_treeevaluate_ewald_correction</a> (int target, int mode, double pos_x, double pos_y, double pos_z, double aold)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a31">force_treeevaluate_potential</a> (int target, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a32">force_treeevaluate_potential_shortrange</a> (int target, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a33">force_treeallocate</a> (int maxnodes, int maxpart)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a34">force_treefree</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a35">force_treeevaluate_direct</a> (int target, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a36">dump_particles</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a37">ewald_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a38">ewald_corr</a> (double dx, double dy, double dz, double *fper)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a39">ewald_pot_corr</a> (double dx, double dy, double dz)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a40">ewald_psi</a> (double x[3])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a41">ewald_force</a> (int iii, int jjj, int kkk, double x[3], double force[3])</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
gravitational tree and code for Ewald correction 
<p>
This file contains the computation of the gravitational force by means of a tree. The type of tree implemented is a geometrical oct-tree, starting from a cube encompassing all particles. This cube is automatically found in the domain decomposition, which also splits up the global "top-level" tree along node boundaries, moving the particles of different parts of the tree to separate processors. Tree nodes can be dynamically updated in drift/kick operations to avoid having to reconstruct the tree every timestep.
<p>
Definition in file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="forcetree.c::EN"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define EN&nbsp;&nbsp;&nbsp;64          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Size of 3D lock-up table for Ewald correction force 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00045">45</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l03112">ewald_pot_corr()</a>, and <a class="el" href="forcetree_8c-source.html#l01777">force_treeevaluate_ewald_correction()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="forcetree.c::NEAREST"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NEAREST          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">x&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((x)&gt;boxhalf)?((x)-boxsize):(((x)&lt;-boxhalf)?((x)+boxsize):(x)))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Macro that maps a distance to the nearest periodic neighbour 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00043">43</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l01777">force_treeevaluate_ewald_correction()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="forcetree.c::NTAB"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NTAB&nbsp;&nbsp;&nbsp;1000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
length of lock-up table for short-range force kernel in TreePM algorithm 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00031">31</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a36" doxytag="forcetree.c::dump_particles"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dump_particles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function dumps some of the basic particle data to a file. In case the tree construction fails, it is called just before the run terminates with an error message. Examination of the generated file may then give clues to what caused the problem. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02835">2835</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00294">force_create_empty_nodes()</a>, and <a class="el" href="forcetree_8c-source.html#l00093">force_treebuild_single()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="forcetree.c::ewald_corr"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ewald_corr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname" nowrap> <em>dx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>dy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>dz</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double *&nbsp;</td>
          <td class="mdname" nowrap> <em>fper</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function looks up the correction force due to the infinite number of periodic particle/node images. We here use trilinear interpolation to get it from the precomputed tables, which contain one octant around the target particle at the origin. The other octants are obtained from it by exploiting the symmetry properties. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l03023">3023</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="forcetree.c::ewald_force"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ewald_force           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>iii</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>jjj</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>kkk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>[3], </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>force</em>[3]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function computes the force correction term (difference between full force of infinite lattice and nearest image) by Ewald summation. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l03206">3206</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="forcetree.c::ewald_init"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ewald_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function initializes tables with the correction force and the correction potential due to the periodic images of a point mass located at the origin. These corrections are obtained by Ewald summation. (See Hernquist, Bouchet, Suto, ApJS, 1991, 75, 231) The correction fields are used to obtain the full periodic force if periodic boundaries combined with the pure tree algorithm are used. For the TreePM algorithm, the Ewald correction is not used.<p>
The correction fields are stored on disk once they are computed. If a corresponding file is found, they are loaded from disk to speed up the initialization. The Ewald summation is done in parallel, i.e. the processors share the work to compute the tables if needed. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02874">2874</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>.
<p>
Referenced by <a class="el" href="begrun_8c-source.html#l00028">begrun()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="forcetree.c::ewald_pot_corr"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double ewald_pot_corr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname" nowrap> <em>dx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>dy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>dz</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function looks up the correction potential due to the infinite number of periodic particle/node images. We here use tri-linear interpolation to get it from the precomputed table, which contains one octant around the target particle at the origin. The other octants are obtained from it by exploiting symmetry properties. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l03112">3112</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="forcetree_8c-source.html#l00045">EN</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="forcetree.c::ewald_psi"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double ewald_psi           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>x</em>[3]          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function computes the potential correction term by means of Ewald summation. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l03165">3165</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="forcetree.c::force_create_empty_nodes"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_create_empty_nodes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>no</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>topnode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>bits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>z</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>nodecount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>nextfree</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function recursively creates a set of empty tree nodes which corresponds to the top-level tree for the domain grid. This is done to ensure that this top-level tree is always "complete" so that we can easily associate the pseudo-particles of other CPUs with tree-nodes at a given level in the tree, even when the particle population is so sparse that some of these nodes are actually empty. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00294">294</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="forcetree_8c-source.html#l02835">dump_particles()</a>, <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="allvars_8h-source.html#l00211">topnode_data::Leaf</a>, <a class="el" href="allvars_8h-source.html#l00566">NODE::len</a>, <a class="el" href="allvars_8c-source.html#l00138">MaxNodes</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="peano_8c-source.html#l00263">peano_hilbert_key()</a>, <a class="el" href="allvars_8h-source.html#l00574">NODE::suns</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00093">force_treebuild_single()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="forcetree.c::force_exchange_pseudodata"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_exchange_pseudodata           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function communicates the values of the multipole moments of the top-level tree-nodes of the domain grid. This data can then be used to update the pseudo-particles on each CPU accordingly. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00686">686</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00579">NODE::bitflags</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00063">DomainMoment</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>, <a class="el" href="allvars_8h-source.html#l00185">DomainNODE::mass</a>, <a class="el" href="allvars_8h-source.html#l00578">NODE::mass</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8h-source.html#l00183">DomainNODE::s</a>, <a class="el" href="allvars_8h-source.html#l00577">NODE::s</a>, <a class="el" href="structNODE.html#o10">NODE::u</a>, <a class="el" href="allvars_8h-source.html#l00184">DomainNODE::vs</a>, and <a class="el" href="allvars_8h-source.html#l00600">extNODE::vs</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="forcetree.c::force_flag_localnodes"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_flag_localnodes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function flags nodes in the top-level tree that are dependent on local particle data. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00836">836</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00579">NODE::bitflags</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00061">force_treebuild()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="forcetree.c::force_insert_pseudo_particles"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_insert_pseudo_particles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
this function inserts pseudo-particles which will represent the mass distribution of the other CPUs. Initially, the mass of the pseudo-particles is set to zero, and their coordinate is set to the center of the domain-cell they correspond to. These quantities will be updated later on. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00348">348</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="allvars_8c-source.html#l00063">DomainMoment</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8h-source.html#l00185">DomainNODE::mass</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, and <a class="el" href="allvars_8h-source.html#l00183">DomainNODE::s</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00093">force_treebuild_single()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="forcetree.c::force_treeallocate"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_treeallocate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxnodes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxpart</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function allocates the memory used for storage of the tree and of auxiliary arrays needed for tree-walk and link-lists. Usually, maxnodes approximately equal to 0.7*maxpart is sufficient to store the tree for up to maxpart particles.<p>
&lt; Maximum number of nodes in the top-level tree used for domain decomposition <p>
&lt; Maximum number of nodes in the top-level tree used for domain decomposition 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02622">2622</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c-source.html#l00138">MaxNodes</a>, and <a class="el" href="allvars_8c-source.html#l00141">Nodes_base</a>.
<p>
Referenced by <a class="el" href="init_8c-source.html#l00020">init()</a>, <a class="el" href="pm__periodic_8c-source.html#l00181">pmforce_periodic()</a>, <a class="el" href="pm__periodic_8c-source.html#l00694">pmpotential_periodic()</a>, and <a class="el" href="restart_8c-source.html#l00035">restart()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="forcetree.c::force_treebuild"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int force_treebuild           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>npart</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is a driver routine for constructing the gravitational oct-tree, which is done by calling a small number of other functions. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00061">61</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="forcetree_8c-source.html#l00836">force_flag_localnodes()</a>, <a class="el" href="forcetree_8c-source.html#l00093">force_treebuild_single()</a>, <a class="el" href="forcetree_8c-source.html#l00673">force_update_pseudoparticles()</a>, <a class="el" href="allvars_8c-source.html#l00139">Numnodestree</a>, <a class="el" href="allvars_8h-source.html#l00350">global_data_all_processes::Time</a>, and <a class="el" href="allvars_8c-source.html#l00079">TimeOfLastTreeConstruction</a>.
<p>
Referenced by <a class="el" href="potential_8c-source.html#l00022">compute_potential()</a>, <a class="el" href="gravtree_8c-source.html#l00027">gravity_tree()</a>, and <a class="el" href="ngb_8c-source.html#l00403">ngb_treebuild()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="forcetree.c::force_treebuild_single"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int force_treebuild_single           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>npart</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Constructs the gravitational oct-tree.<p>
The index convention for accessing tree nodes is the following: the indices 0...NumPart-1 reference single particles, the indices All.MaxPart.... All.MaxPart+nodes-1 reference tree nodes. `Nodes_base' points to the first tree node, while `nodes' is shifted such that nodes[All.MaxPart] gives the first tree node. Finally, node indices with values 'All.MaxPart + MaxNodes' and larger indicate "pseudo particles", i.e. multipole moments of top-level nodes that lie on different CPUs. If such a node needs to be opened, the corresponding particle must be exported to that CPU. The 'Extnodes' structure parallels that of 'Nodes'. Its information is only needed for the SPH part of the computation. (The data is split onto these two structures as a tuning measure. If it is merged into 'Nodes' a somewhat bigger size of the nodes also for gravity would result, which would reduce cache utilization slightly.<p>
&lt; Bits per dimension available for Peano-Hilbert order. Note: If peanokey is defined as type int, the allowed maximum is 10. If 64-bit integers are used, the maximum is 21 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00093">93</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00034">BITS_PER_DIMENSION</a>, <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8h-source.html#l00208">topnode_data::Daughter</a>, <a class="el" href="allvars_8c-source.html#l00047">DomainCenter</a>, <a class="el" href="allvars_8c-source.html#l00046">DomainCorner</a>, <a class="el" href="allvars_8c-source.html#l00049">DomainFac</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="forcetree_8c-source.html#l02835">dump_particles()</a>, <a class="el" href="endrun_8c-source.html#l00025">endrun()</a>, <a class="el" href="forcetree_8c-source.html#l00294">force_create_empty_nodes()</a>, <a class="el" href="forcetree_8c-source.html#l00348">force_insert_pseudo_particles()</a>, <a class="el" href="forcetree_8c-source.html#l00424">force_update_node_recursive()</a>, <a class="el" href="allvars_8h-source.html#l00459">global_data_all_processes::ForceSoftening</a>, <a class="el" href="system_8c-source.html#l00029">get_random_number()</a>, <a class="el" href="allvars_8h-source.html#l00518">particle_data::GravCost</a>, <a class="el" href="allvars_8h-source.html#l00211">topnode_data::Leaf</a>, <a class="el" href="allvars_8h-source.html#l00566">NODE::len</a>, <a class="el" href="allvars_8c-source.html#l00138">MaxNodes</a>, <a class="el" href="allvars_8h-source.html#l00256">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8c-source.html#l00147">Nextnode</a>, <a class="el" href="allvars_8h-source.html#l00581">NODE::nextnode</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="peano_8c-source.html#l00263">peano_hilbert_key()</a>, <a class="el" href="allvars_8h-source.html#l00032">peanokey</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8h-source.html#l00212">topnode_data::Size</a>, <a class="el" href="allvars_8h-source.html#l00213">topnode_data::StartKey</a>, <a class="el" href="allvars_8h-source.html#l00574">NODE::suns</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8c-source.html#l00075">TopNodes</a>, <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00061">force_treebuild()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="forcetree.c::force_treeevaluate"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int force_treeevaluate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double *&nbsp;</td>
          <td class="mdname" nowrap> <em>ewaldcountsum</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This routine computes the gravitational force for a given local particle, or for a particle in the communication buffer. Depending on the value of TypeOfOpeningCriterion, either the geometrical BH cell-opening criterion, or the `relative' opening criterion is used. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l01128">1128</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00409">global_data_all_processes::ErrTolForceAcc</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h-source.html#l00505">particle_data::OldAcc</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="gravtree_8c-source.html#l00027">gravity_tree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="forcetree.c::force_treeevaluate_direct"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int force_treeevaluate_direct           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function does the force computation with direct summation for the specified particle in the communication buffer. This can be useful for debugging purposes, in particular for explicit checks of the force accuracy. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02704">2704</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="gravtree__forcetest_8c-source.html#l00028">gravity_forcetest()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="forcetree.c::force_treeevaluate_ewald_correction"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int force_treeevaluate_ewald_correction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>pos_x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>pos_y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>pos_z</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>aold</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function computes the Ewald correction, and is needed if periodic boundary conditions together with a pure tree algorithm are used. Note that the ordinary tree walk does not carry out this correction directly as it was done in Gadget-1.1. Instead, the tree is walked a second time. This is actually faster because the "Ewald-Treewalk" can use a different opening criterion than the normal tree walk. In particular, the Ewald correction is negligible for particles that are very close, but it is large for particles that are far away (this is quite different for the normal direct force). So we can here use a different opening criterion. Sufficient accuracy is usually obtained if the node length has dropped to a certain fraction ~&lt; 0.25 of the BoxLength. However, we may only short-cut the interaction list of the normal full Ewald tree walk if we are sure that the whole node and all daughter nodes "lie on the same side" of the periodic boundary, i.e. that the real tree walk would not find a daughter node or particle that was mapped to a different nearest neighbour position when the tree walk would be further refined. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l01777">1777</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00692">gravdata_in::Acc</a>, <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00579">NODE::bitflags</a>, <a class="el" href="allvars_8h-source.html#l00259">global_data_all_processes::BoxSize</a>, <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00058">DomainTask</a>, <a class="el" href="forcetree_8c-source.html#l00045">EN</a>, <a class="el" href="allvars_8h-source.html#l00408">global_data_all_processes::ErrTolTheta</a>, <a class="el" href="allvars_8c-source.html#l00030">Exportflag</a>, <a class="el" href="allvars_8h-source.html#l00497">particle_data::GravAccel</a>, <a class="el" href="allvars_8h-source.html#l00518">particle_data::GravCost</a>, <a class="el" href="allvars_8c-source.html#l00180">GravDataResult</a>, <a class="el" href="allvars_8h-source.html#l00566">NODE::len</a>, <a class="el" href="allvars_8h-source.html#l00495">particle_data::Mass</a>, <a class="el" href="allvars_8h-source.html#l00578">NODE::mass</a>, <a class="el" href="allvars_8h-source.html#l00256">global_data_all_processes::MaxPart</a>, <a class="el" href="forcetree_8c-source.html#l00043">NEAREST</a>, <a class="el" href="allvars_8c-source.html#l00147">Nextnode</a>, <a class="el" href="allvars_8h-source.html#l00581">NODE::nextnode</a>, <a class="el" href="allvars_8h-source.html#l00705">gravdata_in::Ninteractions</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8h-source.html#l00577">NODE::s</a>, <a class="el" href="allvars_8h-source.html#l00580">NODE::sibling</a>, <a class="el" href="structNODE.html#o10">NODE::u</a>, <a class="el" href="structgravdata__in.html#o3">gravdata_in::u</a>, and <a class="el" href="structgravdata__in.html#o6">gravdata_in::w</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="forcetree.c::force_treeevaluate_potential"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_treeevaluate_potential           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This routine computes the gravitational potential by walking the tree. The same opening criteria is used as for the gravitational force walk. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02043">2043</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00409">global_data_all_processes::ErrTolForceAcc</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h-source.html#l00505">particle_data::OldAcc</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="potential_8c-source.html#l00022">compute_potential()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="forcetree.c::force_treeevaluate_potential_shortrange"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_treeevaluate_potential_shortrange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function computes the short-range potential when the TreePM algorithm is used. This potential is the Newtonian potential, modified by a complementary error function. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02304">2304</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00409">global_data_all_processes::ErrTolForceAcc</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h-source.html#l00505">particle_data::OldAcc</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="potential_8c-source.html#l00022">compute_potential()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="forcetree.c::force_treeevaluate_shortrange"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int force_treeevaluate_shortrange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
In the TreePM algorithm, the tree is walked only locally around the target coordinate. Tree nodes that fall outside a box of half side-length Rcut= RCUT*ASMTH*MeshSize can be discarded. The short-range potential is modified by a complementary error function, multiplied with the Newtonian form. The resulting short-range suppression compared to the Newtonian force is tabulated, because looking up from this table is faster than recomputing the corresponding factor, despite the memory-access panelty (which reduces cache performance) incurred by the table. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l01422">1422</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00409">global_data_all_processes::ErrTolForceAcc</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h-source.html#l00505">particle_data::OldAcc</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, and <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>.
<p>
Referenced by <a class="el" href="gravtree_8c-source.html#l00027">gravity_tree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="forcetree.c::force_treefree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_treefree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function frees the memory allocated for the tree, i.e. it frees the space allocated by the function <a class="el" href="forcetree_8c.html#a33">force_treeallocate()</a>. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l02687">2687</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
Referenced by <a class="el" href="pm__periodic_8c-source.html#l00181">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c-source.html#l00694">pmpotential_periodic()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="forcetree.c::force_treeupdate_pseudos"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_treeupdate_pseudos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function updates the top-level tree after the multipole moments of the pseudo-particles have been updated. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00734">734</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00579">NODE::bitflags</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00063">DomainMoment</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8h-source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h-source.html#l00459">global_data_all_processes::ForceSoftening</a>, <a class="el" href="allvars_8h-source.html#l00578">NODE::mass</a>, <a class="el" href="allvars_8h-source.html#l00185">DomainNODE::mass</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8h-source.html#l00577">NODE::s</a>, <a class="el" href="allvars_8h-source.html#l00183">DomainNODE::s</a>, <a class="el" href="structNODE.html#o10">NODE::u</a>, <a class="el" href="allvars_8h-source.html#l00600">extNODE::vs</a>, and <a class="el" href="allvars_8h-source.html#l00184">DomainNODE::vs</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="forcetree.c::force_update_hmax"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_hmax           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function updates the hmax-values in tree nodes that hold SPH particles. These values are needed to find all neighbors in the hydro-force computation. Since the Hsml-values are potentially changed in the SPH-denity computation, <a class="el" href="forcetree_8c.html#a25">force_update_hmax()</a> should be carried out just before the hydrodynamical SPH forces are computed, i.e. after <a class="el" href="density_8c.html#a8">density()</a>. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l01016">1016</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00061">DomainHmax</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, and <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>.
<p>
Referenced by <a class="el" href="accel_8c-source.html#l00024">compute_accelerations()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="forcetree.c::force_update_len"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_len           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function updates the side-length of tree nodes in case the tree is not reconstructed, but only drifted. The grouping of particles to tree nodes is not changed in this case, but some tree nodes may need to be enlarged because particles moved out of their original bounds. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00887">887</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8c-source.html#l00060">DomainTreeNodeLen</a>, and <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>.
<p>
Referenced by <a class="el" href="predict_8c-source.html#l00031">move_particles()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="forcetree.c::force_update_node_hmax_local"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_node_hmax_local           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This routine updates the hmax-values of local tree nodes. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l01053">1053</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>, <a class="el" href="allvars_8c-source.html#l00148">Father</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8h-source.html#l00599">extNODE::hmax</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="forcetree.c::force_update_node_hmax_toptree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_node_hmax_toptree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function recursively sets the hmax-values of the top-level tree. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l01089">1089</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00061">DomainHmax</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8h-source.html#l00599">extNODE::hmax</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="forcetree.c::force_update_node_len_local"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_node_len_local           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function recursively enlarges nodes such that they always contain all their daughter nodes and daughter particles. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00925">925</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00148">Father</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8h-source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h-source.html#l00566">NODE::len</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="forcetree.c::force_update_node_len_toptree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_node_len_toptree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function recursively enlarges nodes of the top-level tree such that they always contain all their daughter nodes. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00972">972</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00059">DomainNodeIndex</a>, <a class="el" href="allvars_8c-source.html#l00060">DomainTreeNodeLen</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8h-source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h-source.html#l00566">NODE::len</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, and <a class="el" href="structNODE.html#o10">NODE::u</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="forcetree.c::force_update_node_recursive"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_node_recursive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>no</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sib</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>father</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
this routine determines the multipole moments for a given internal node and all its subnodes using a recursive computation. The result is stored in the Nodes[] structure in the sequence of this tree-walk.<p>
Note that the bitflags-variable for each node is used to store in the lowest bits some special information: Bit 0 flags whether the node belongs to the top-level tree corresponding to the domain decomposition, while Bit 1 signals whether the top-level node is dependent on local mass.<p>
If UNEQUALSOFTENINGS is set, bits 2-4 give the particle type with the maximum softening among the particles in the node, and bit 5 flags whether the node contains any particles with lower softening than that. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00424">424</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00579">NODE::bitflags</a>, <a class="el" href="allvars_8h-source.html#l00567">NODE::center</a>, <a class="el" href="structNODE.html#o9">NODE::d</a>, <a class="el" href="allvars_8c-source.html#l00151">Extnodes</a>, <a class="el" href="allvars_8h-source.html#l00582">NODE::father</a>, <a class="el" href="allvars_8h-source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h-source.html#l00459">global_data_all_processes::ForceSoftening</a>, <a class="el" href="allvars_8h-source.html#l00599">extNODE::hmax</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h-source.html#l00578">NODE::mass</a>, <a class="el" href="allvars_8h-source.html#l00495">particle_data::Mass</a>, <a class="el" href="allvars_8h-source.html#l00256">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8c-source.html#l00147">Nextnode</a>, <a class="el" href="allvars_8h-source.html#l00581">NODE::nextnode</a>, <a class="el" href="allvars_8c-source.html#l00141">Nodes</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="allvars_8h-source.html#l00577">NODE::s</a>, <a class="el" href="allvars_8h-source.html#l00580">NODE::sibling</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, <a class="el" href="allvars_8h-source.html#l00574">NODE::suns</a>, <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>, <a class="el" href="structNODE.html#o10">NODE::u</a>, <a class="el" href="allvars_8h-source.html#l00496">particle_data::Vel</a>, and <a class="el" href="allvars_8h-source.html#l00600">extNODE::vs</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00093">force_treebuild_single()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="forcetree.c::force_update_pseudoparticles"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void force_update_pseudoparticles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function updates the multipole moments of the pseudo-particles that represent the mass distribution on different CPUs. For that purpose, it first exchanges the necessary data, and then updates the top-level tree accordingly. The detailed implementation of these two tasks is done in separate functions. 
<p>
Definition at line <a class="el" href="forcetree_8c-source.html#l00673">673</a> of file <a class="el" href="forcetree_8c-source.html">forcetree.c</a>.
<p>
Referenced by <a class="el" href="forcetree_8c-source.html#l00061">force_treebuild()</a>, and <a class="el" href="predict_8c-source.html#l00031">move_particles()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:42 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
