<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GADGET-2: gravtree.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>gravtree.c File Reference</h1>main driver routines for gravitational (short-range) force computation <a href="#_details">More...</a>
<p>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;float.h&gt;</code><br>
<code>#include &lt;mpi.h&gt;</code><br>
<code>#include "<a class="el" href="allvars_8h-source.html">allvars.h</a>"</code><br>
<code>#include "<a class="el" href="proto_8h-source.html">proto.h</a>"</code><br>

<p>
<a href="gravtree_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gravtree_8c.html#a0">gravity_tree</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gravtree_8c.html#a1">set_softenings</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gravtree_8c.html#a2">grav_tree_compare_key</a> (const void *a, const void *b)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
main driver routines for gravitational (short-range) force computation 
<p>
This file contains the code for the gravitational force computation by means of the tree algorithm. To this end, a tree force is computed for all active local particles, and particles are exported to other processors if needed, where they can receive additional force contributions. If the TreePM algorithm is enabled, the force computed will only be the short-range part.
<p>
Definition in file <a class="el" href="gravtree_8c-source.html">gravtree.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="gravtree.c::grav_tree_compare_key"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int grav_tree_compare_key           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>b</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used as a comparison kernel in a sort routine. It is used to group particles in the communication buffer that are going to be sent to the same CPU. 
<p>
Definition at line <a class="el" href="gravtree_8c-source.html#l00511">511</a> of file <a class="el" href="gravtree_8c-source.html">gravtree.c</a>.
<p>
Referenced by <a class="el" href="potential_8c-source.html#l00022">compute_potential()</a>, <a class="el" href="gravtree__forcetest_8c-source.html#l00028">gravity_forcetest()</a>, and <a class="el" href="gravtree_8c-source.html#l00027">gravity_tree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="gravtree.c::gravity_tree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void gravity_tree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function computes the gravitational forces for all active particles. If needed, a new tree is constructed, otherwise the dynamically updated tree is used. Particles are only exported to other processors when really needed, thereby allowing a good use of the communication buffer. 
<p>
Definition at line <a class="el" href="gravtree_8c-source.html#l00027">27</a> of file <a class="el" href="gravtree_8c-source.html">gravtree.c</a>.
<p>
References <a class="el" href="allvars_8h-source.html#l00692">gravdata_in::Acc</a>, <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00270">global_data_all_processes::BunchSizeForce</a>, <a class="el" href="allvars_8h-source.html#l00328">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="allvars_8h-source.html#l00394">global_data_all_processes::CPU_CommSum</a>, <a class="el" href="allvars_8h-source.html#l00395">global_data_all_processes::CPU_Imbalance</a>, <a class="el" href="allvars_8h-source.html#l00387">global_data_all_processes::CPU_TreeConstruction</a>, <a class="el" href="allvars_8h-source.html#l00388">global_data_all_processes::CPU_TreeWalk</a>, <a class="el" href="allvars_8h-source.html#l00408">global_data_all_processes::ErrTolTheta</a>, <a class="el" href="allvars_8c-source.html#l00030">Exportflag</a>, <a class="el" href="allvars_8c-source.html#l00089">FdTimings</a>, <a class="el" href="forcetree_8c-source.html#l00061">force_treebuild()</a>, <a class="el" href="forcetree_8c-source.html#l01128">force_treeevaluate()</a>, <a class="el" href="forcetree_8c-source.html#l01422">force_treeevaluate_shortrange()</a>, <a class="el" href="allvars_8h-source.html#l00302">global_data_all_processes::G</a>, <a class="el" href="gravtree_8c-source.html#l00511">grav_tree_compare_key()</a>, <a class="el" href="allvars_8h-source.html#l00497">particle_data::GravAccel</a>, <a class="el" href="allvars_8h-source.html#l00518">particle_data::GravCost</a>, <a class="el" href="allvars_8c-source.html#l00180">GravDataGet</a>, <a class="el" href="allvars_8c-source.html#l00180">GravDataIn</a>, <a class="el" href="allvars_8c-source.html#l00186">GravDataIndexTable</a>, <a class="el" href="allvars_8c-source.html#l00180">GravDataOut</a>, <a class="el" href="allvars_8c-source.html#l00180">GravDataResult</a>, <a class="el" href="allvars_8h-source.html#l00499">particle_data::GravPM</a>, <a class="el" href="allvars_8h-source.html#l00537">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h-source.html#l00319">global_data_all_processes::Hubble</a>, <a class="el" href="allvars_8h-source.html#l00717">gravdata_index::Index</a>, <a class="el" href="allvars_8h-source.html#l00256">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8h-source.html#l00705">gravdata_in::Ninteractions</a>, <a class="el" href="allvars_8c-source.html#l00012">NTask</a>, <a class="el" href="allvars_8h-source.html#l00345">global_data_all_processes::NumCurrentTiStep</a>, <a class="el" href="allvars_8c-source.html#l00020">NumForceUpdate</a>, <a class="el" href="allvars_8c-source.html#l00015">NumPart</a>, <a class="el" href="allvars_8h-source.html#l00704">gravdata_in::OldAcc</a>, <a class="el" href="allvars_8h-source.html#l00505">particle_data::OldAcc</a>, <a class="el" href="allvars_8h-source.html#l00320">global_data_all_processes::Omega0</a>, <a class="el" href="allvars_8h-source.html#l00321">global_data_all_processes::OmegaLambda</a>, <a class="el" href="allvars_8c-source.html#l00119">P</a>, <a class="el" href="allvars_8h-source.html#l00691">gravdata_in::Pos</a>, <a class="el" href="allvars_8h-source.html#l00494">particle_data::Pos</a>, <a class="el" href="system_8c-source.html#l00053">second()</a>, <a class="el" href="gravtree_8c-source.html#l00454">set_softenings()</a>, <a class="el" href="allvars_8h-source.html#l00718">gravdata_index::SortIndex</a>, <a class="el" href="allvars_8c-source.html#l00127">SphP</a>, <a class="el" href="tags_8h-source.html#l00013">TAG_GRAV_A</a>, <a class="el" href="tags_8h-source.html#l00014">TAG_GRAV_B</a>, <a class="el" href="allvars_8h-source.html#l00716">gravdata_index::Task</a>, <a class="el" href="allvars_8c-source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h-source.html#l00359">global_data_all_processes::Ti_Current</a>, <a class="el" href="allvars_8h-source.html#l00513">particle_data::Ti_endstep</a>, <a class="el" href="allvars_8h-source.html#l00350">global_data_all_processes::Time</a>, <a class="el" href="system_8c-source.html#l00074">timediff()</a>, <a class="el" href="allvars_8h-source.html#l00352">global_data_all_processes::TimeStep</a>, <a class="el" href="allvars_8h-source.html#l00296">global_data_all_processes::TotNumOfForces</a>, <a class="el" href="allvars_8h-source.html#l00253">global_data_all_processes::TotNumPart</a>, <a class="el" href="allvars_8h-source.html#l00279">global_data_all_processes::TreeAllocFactor</a>, <a class="el" href="allvars_8c-source.html#l00034">TreeReconstructFlag</a>, <a class="el" href="allvars_8h-source.html#l00512">particle_data::Type</a>, <a class="el" href="allvars_8h-source.html#l00331">global_data_all_processes::TypeOfOpeningCriterion</a>, <a class="el" href="structgravdata__in.html#o3">gravdata_in::u</a>, and <a class="el" href="structgravdata__in.html#o6">gravdata_in::w</a>.
<p>
Referenced by <a class="el" href="accel_8c-source.html#l00024">compute_accelerations()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="gravtree.c::set_softenings"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void set_softenings           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function sets the (comoving) softening length of all particle types in the table All.SofteningTable[...]. We check that the physical softening length is bounded by the Softening-MaxPhys values. 
<p>
Definition at line <a class="el" href="gravtree_8c-source.html#l00454">454</a> of file <a class="el" href="gravtree_8c-source.html">gravtree.c</a>.
<p>
References <a class="el" href="allvars_8c-source.html#l00111">All</a>, <a class="el" href="allvars_8h-source.html#l00328">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="allvars_8h-source.html#l00459">global_data_all_processes::ForceSoftening</a>, <a class="el" href="allvars_8h-source.html#l00441">global_data_all_processes::MinGasHsml</a>, <a class="el" href="allvars_8h-source.html#l00440">global_data_all_processes::MinGasHsmlFractional</a>, <a class="el" href="allvars_8h-source.html#l00449">global_data_all_processes::SofteningBndry</a>, <a class="el" href="allvars_8h-source.html#l00456">global_data_all_processes::SofteningBndryMaxPhys</a>, <a class="el" href="allvars_8h-source.html#l00447">global_data_all_processes::SofteningBulge</a>, <a class="el" href="allvars_8h-source.html#l00454">global_data_all_processes::SofteningBulgeMaxPhys</a>, <a class="el" href="allvars_8h-source.html#l00446">global_data_all_processes::SofteningDisk</a>, <a class="el" href="allvars_8h-source.html#l00453">global_data_all_processes::SofteningDiskMaxPhys</a>, <a class="el" href="allvars_8h-source.html#l00444">global_data_all_processes::SofteningGas</a>, <a class="el" href="allvars_8h-source.html#l00451">global_data_all_processes::SofteningGasMaxPhys</a>, <a class="el" href="allvars_8h-source.html#l00445">global_data_all_processes::SofteningHalo</a>, <a class="el" href="allvars_8h-source.html#l00452">global_data_all_processes::SofteningHaloMaxPhys</a>, <a class="el" href="allvars_8h-source.html#l00448">global_data_all_processes::SofteningStars</a>, <a class="el" href="allvars_8h-source.html#l00455">global_data_all_processes::SofteningStarsMaxPhys</a>, <a class="el" href="allvars_8h-source.html#l00458">global_data_all_processes::SofteningTable</a>, and <a class="el" href="allvars_8h-source.html#l00350">global_data_all_processes::Time</a>.
<p>
Referenced by <a class="el" href="potential_8c-source.html#l00022">compute_potential()</a>, <a class="el" href="gravtree__forcetest_8c-source.html#l00028">gravity_forcetest()</a>, <a class="el" href="gravtree_8c-source.html#l00027">gravity_tree()</a>, and <a class="el" href="init_8c-source.html#l00020">init()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat Apr 22 15:29:42 2006 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
